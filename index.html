<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ YouTube í”„ë¡œ ë¶„ì„ê¸° - ì™„ì „ ë²¤ì¹˜ë§ˆí‚¹ ë„êµ¬</title>
    <style>
        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-elevated: #0e3460;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #707070;
            --accent-primary: #ff6b6b;
            --accent-secondary: #4ecdc4;
            --accent-tertiary: #45b7d1;
            --success: #51cf66;
            --warning: #ffd43b;
            --error: #ff6b6b;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-lg);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: var(--space-xl);
            position: relative;
        }

        .header-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .api-settings-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: var(--radius-lg);
            color: white;
            padding: var(--space-md) var(--space-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .api-settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .api-settings-btn.connected {
            background: linear-gradient(135deg, var(--success), #40c057);
            box-shadow: 0 4px 12px rgba(81, 207, 102, 0.3);
        }

        .api-settings-btn.connected:hover {
            box-shadow: 0 6px 20px rgba(81, 207, 102, 0.4);
        }

        .api-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }

        .quota-monitor {
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--radius-md);
            padding: var(--space-sm) var(--space-md);
            font-size: 0.8rem;
            color: var(--text-secondary);
            min-width: 150px;
        }

        .quota-usage {
            font-weight: 600;
        }

        .quota-warning {
            color: var(--warning) !important;
        }

        .quota-critical {
            color: var(--error) !important;
        }

        @media (max-width: 768px) {
            .api-settings-btn {
                position: static;
                margin-top: var(--space-md);
                align-self: center;
            }
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-md);
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-lg);
        }

        .api-key-setup {
            background: linear-gradient(135deg, var(--warning), #f59e0b);
            color: #000;
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-lg);
            font-weight: 500;
            display: none;
        }

        .api-key-setup.show {
            display: block;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
            overflow-x: auto;
            padding: var(--space-sm);
            border-radius: var(--radius-lg);
            background: var(--bg-secondary);
        }

        .nav-tab {
            padding: var(--space-md) var(--space-lg);
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-header {
            margin-bottom: var(--space-lg);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .quick-action {
            padding: var(--space-xs) var(--space-md);
            background: var(--bg-tertiary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all var(--transition);
        }

        .quick-action:hover {
            background: var(--accent-primary);
            color: white;
            transform: translateY(-1px);
        }

        .advanced-filters-section {
            margin-bottom: var(--space-lg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
        }

        .advanced-filters-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            cursor: pointer;
            user-select: none;
            transition: all var(--transition);
        }

        .advanced-filters-toggle:hover {
            background: rgba(255,255,255,0.05);
        }

        .advanced-filters-toggle.active {
            background: rgba(255,255,255,0.1);
        }

        .toggle-icon {
            transition: transform var(--transition);
        }

        .advanced-filters-content {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: var(--space-lg);
        }

        .filter-category {
            margin-bottom: var(--space-lg);
        }

        .filter-category-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .filter-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent-tertiary), var(--purple));
            color: white;
        }

        .results-section {
            margin-top: var(--space-xl);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .video-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition);
            position: relative;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--accent-primary);
        }

        .thumbnail {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            overflow: hidden;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .outlier-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }

        .rank-s { background: rgba(255, 215, 0, 0.9); color: #000; }
        .rank-a { background: rgba(50, 205, 50, 0.9); color: #000; }
        .rank-b { background: rgba(65, 105, 225, 0.9); color: white; }
        .rank-c { background: rgba(255, 165, 0, 0.9); color: #000; }
        .rank-d { background: rgba(220, 20, 60, 0.9); color: white; }

        .video-info {
            padding: var(--space-md);
        }

        .video-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            line-height: 1.4;
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-title:hover {
            color: var(--accent-primary);
        }

        .channel-name {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: var(--space-xs);
        }

        .video-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            font-size: 0.8rem;
            color: var(--text-tertiary);
            margin-bottom: var(--space-sm);
        }

        .benchmarking-data {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
            font-size: 0.7rem;
        }

        .benchmarking-data span {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .video-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
            background: rgba(255,255,255,0.05);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .outlier-score-detail {
            text-align: center;
        }

        .score-main {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .score-label {
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .view-count {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .published {
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .form-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input, .form-select {
            padding: var(--space-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all var(--transition);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        /* í‚¤ì›Œë“œ ì…ë ¥ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .keyword-input-container {
            width: 100%;
        }

        .keyword-input-wrapper {
            display: flex;
            gap: var(--space-sm);
            align-items: center;
        }

        .keyword-input {
            flex: 1;
        }

        .add-keyword-btn {
            padding: var(--space-md);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            white-space: nowrap;
        }

        .add-keyword-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .keywords-display {
            margin-top: var(--space-md);
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            min-height: 40px;
            padding: var(--space-sm);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.02);
        }

        .keyword-tag {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-sm);
            background: linear-gradient(135deg, var(--accent-tertiary), var(--purple));
            color: white;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all var(--transition);
            cursor: default;
        }

        .keyword-tag.url-tag {
            background: linear-gradient(135deg, var(--success), #40c057);
        }

        .keyword-tag .remove-tag {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }

        .keyword-tag .remove-tag:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .keywords-display:empty::before {
            content: "í‚¤ì›Œë“œë‚˜ URLì„ ì¶”ê°€í•˜ë©´ ì—¬ê¸°ì— íƒœê·¸ë¡œ í‘œì‹œë©ë‹ˆë‹¤";
            color: var(--text-tertiary);
            font-style: italic;
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: var(--space-xl);
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 107, 107, 0.3);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-md);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .video-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition);
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .video-thumbnail {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            padding: var(--space-md);
        }

        .video-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .metric-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--space-xs);
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Insights */
        .insights {
            margin-top: var(--space-lg);
        }

        .insight-item {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .insight-item.success {
            background: rgba(81, 207, 102, 0.1);
            border-left: 4px solid var(--success);
        }

        .insight-item.warning {
            background: rgba(255, 212, 59, 0.1);
            border-left: 4px solid var(--warning);
        }

        .insight-item.info {
            background: rgba(69, 183, 209, 0.1);
            border-left: 4px solid var(--accent-tertiary);
        }

        /* Progress bars */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin: var(--space-sm) 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width var(--transition);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-md);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .api-settings-btn {
                position: static;
                margin-top: var(--space-md);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-container">
                <button class="api-settings-btn" id="apiSettingsBtn" onclick="openApiModal()">
                    <span class="api-status-indicator"></span>
                    <span id="apiSettingsBtnText">âš™ï¸ API ì„¤ì •</span>
                </button>
                
                <div class="quota-monitor" id="quotaMonitor">
                    <div>ğŸ“Š API ì‚¬ìš©ëŸ‰</div>
                    <div class="quota-usage" id="quota-usage">0/10000 (0.0%)</div>
                </div>
                
                <h1>ğŸ¯ YouTube í”„ë¡œ ë¶„ì„ê¸°</h1>
                <p>YouTube Data APIë¥¼ í™œìš©í•œ ì™„ì „ ë²¤ì¹˜ë§ˆí‚¹ & ê²½ìŸë¶„ì„ ë„êµ¬</p>
            </div>
            
            <div class="api-key-setup" id="apiKeySetup">
                <strong>âš ï¸ API ì„¤ì • í•„ìš”:</strong> 
                YouTube Data API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.
            </div>
        </div>

        <!-- API Usage Monitor -->
        <div class="quota-monitor" id="quotaMonitor" style="text-align: center; margin: 20px 0; padding: 12px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
            <div style="font-size: 14px; font-weight: 500; margin-bottom: 4px;">ğŸ“Š API ì‚¬ìš©ëŸ‰</div>
            <div class="quota-usage" id="quota-usage" style="font-weight: 600;">0/10000 (0.0%)</div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('search')">ğŸ” ì˜ìƒ ê²€ìƒ‰</button>
            <button class="nav-tab" onclick="switchTab('competitor')">ğŸ† ê²½ìŸì ë¶„ì„</button>
            <button class="nav-tab" onclick="switchTab('trending')">ğŸ”¥ íŠ¸ë Œë“œ ë¶„ì„</button>
            <button class="nav-tab" onclick="switchTab('channel')">ğŸ“º ì±„ë„ ë¶„ì„</button>
            <button class="nav-tab" onclick="switchTab('keywords')">ğŸ’¡ í‚¤ì›Œë“œ ë§ˆì´ë‹</button>
            <button class="nav-tab" onclick="switchTab('analytics')">ğŸ“Š ì¢…í•© ë¶„ì„</button>
        </div>

        <!-- ì˜ìƒ ê²€ìƒ‰ íƒ­ -->
        <div id="search-tab" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ” ê³ ê¸‰ ì˜ìƒ ê²€ìƒ‰ & ë¶„ì„</h3>
                </div>
                
                <form id="search-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ê²€ìƒ‰ í‚¤ì›Œë“œ/URL ì…ë ¥</label>
                        <div class="keyword-input-container">
                            <div class="keyword-input-wrapper">
                                <input type="text" id="searchQuery" class="form-input keyword-input" placeholder="í‚¤ì›Œë“œë‚˜ YouTube URLì„ ì…ë ¥í•˜ì„¸ìš”...">
                                <button type="button" id="addKeywordBtn" class="add-keyword-btn">ì¶”ê°€</button>
                            </div>
                            <div class="keywords-display" id="keywordsDisplay"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê²°ê³¼ ìˆ˜</label>
                        <select id="maxResults" class="form-select">
                            <option value="25">25ê°œ</option>
                            <option value="50">50ê°œ</option>
                            <option value="100">100ê°œ</option>
                            <option value="custom">ì§ì ‘ ì…ë ¥</option>
                        </select>
                        <input type="number" id="maxResultsCustom" class="form-input" 
                               placeholder="ê²°ê³¼ ìˆ˜ ì…ë ¥ (1-50)" 
                               min="1" max="50" 
                               style="display: none; margin-top: 8px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì •ë ¬ ê¸°ì¤€</label>
                        <select id="orderBy" class="form-select">
                            <option value="relevance">ê´€ë ¨ë„</option>
                            <option value="viewCount">ì¡°íšŒìˆ˜</option>
                            <option value="date">ìµœì‹ ìˆœ</option>
                            <option value="rating">í‰ì ìˆœ</option>
                            <option value="outlier">Outlier Score</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì˜ìƒ ê¸¸ì´</label>
                        <select id="videoDuration" class="form-select">
                            <option value="">ì „ì²´</option>
                            <option value="short">ìˆì¸  (4ë¶„ ë¯¸ë§Œ)</option>
                            <option value="medium">ì¤‘ê°„ (4-20ë¶„)</option>
                            <option value="long">ê¸´ì˜ìƒ (20ë¶„ ì´ìƒ)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì—…ë¡œë“œ ê¸°ê°„</label>
                        <select id="publishedAfter" class="form-select">
                            <option value="">ì „ì²´</option>
                            <option value="day">24ì‹œê°„ ì´ë‚´</option>
                            <option value="week">1ì£¼ì¼ ì´ë‚´</option>
                            <option value="month">1ê°œì›” ì´ë‚´</option>
                            <option value="year">1ë…„ ì´ë‚´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì§€ì—­</label>
                        <select id="regionCode" class="form-select">
                            <option value="KR">í•œêµ­</option>
                            <option value="US">ë¯¸êµ­</option>
                            <option value="JP">ì¼ë³¸</option>
                            <option value="GB">ì˜êµ­</option>
                        </select>
                    </div>
                </div>
                <div class="quick-actions">
                    <a href="#" class="quick-action" onclick="quickSearch('ìš”ë¦¬ ë ˆì‹œí”¼')">ìš”ë¦¬ ë ˆì‹œí”¼</a>
                    <a href="#" class="quick-action" onclick="quickSearch('í”„ë¡œê·¸ë˜ë° ê°•ì˜')">í”„ë¡œê·¸ë˜ë°</a>
                    <a href="#" class="quick-action" onclick="quickSearch('ì¬í…Œí¬')">ì¬í…Œí¬</a>
                    <a href="#" class="quick-action" onclick="quickSearch('ìš´ë™')">í™ˆíŠ¸ë ˆì´ë‹</a>
                    <a href="#" class="quick-action" onclick="quickSearch('ê²Œì„')">ê²Œì„</a>
                    <a href="#" class="quick-action" onclick="quickSearch('ë·°í‹°')">ë·°í‹°</a>
                </div>
                <!-- ê³ ê¸‰ ë²¤ì¹˜ë§ˆí‚¹ í•„í„° -->
                <div class="advanced-filters-section">
                    <div class="advanced-filters-toggle" onclick="toggleAdvancedFilters()">
                        <span>ğŸ“Š ê³ ê¸‰ ë²¤ì¹˜ë§ˆí‚¹ í•„í„°</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    
                    <div class="advanced-filters-content" id="advanced-filters" style="display: none;">
                        <!-- í•µì‹¬ ì„±ê³¼ ì§€í‘œ -->
                        <div class="filter-category">
                            <h4 class="filter-category-title">ğŸ¯ í•µì‹¬ ì„±ê³¼ ì§€í‘œ</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">ìµœì†Œ Outlier Score</label>
                                    <select id="minOutlierScore" class="form-select">
                                        <option value="">ì œí•œì—†ìŒ</option>
                                        <option value="1">1ì +</option>
                                        <option value="2">2ì +</option>
                                        <option value="3">3ì +</option>
                                        <option value="4">4ì +</option>
                                        <option value="5">5ì  (ìµœìƒìœ„)</option>
                                        <option value="custom">ì§ì ‘ì…ë ¥</option>
                                    </select>
                                    <input type="number" id="minOutlierScoreCustom" class="form-input" placeholder="0-5" min="0" max="5" step="0.1" style="display: none; margin-top: 4px;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ìµœì†Œ ë­í¬ ë“±ê¸‰</label>
                                    <select id="minRankGrade" class="form-select">
                                        <option value="">ì „ì²´ ë“±ê¸‰</option>
                                        <option value="D">Dë“±ê¸‰+</option>
                                        <option value="C">Cë“±ê¸‰+</option>
                                        <option value="B">Bë“±ê¸‰+</option>
                                        <option value="A">Aë“±ê¸‰+</option>
                                        <option value="S">Së“±ê¸‰ë§Œ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- ì¡°íšŒìˆ˜ & ì±„ë„ ê·œëª¨ -->
                        <div class="filter-category">
                            <h4 class="filter-category-title">ğŸ“Š ê·œëª¨ í•„í„°</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">ì¡°íšŒìˆ˜ ë²”ìœ„</label>
                                    <div style="display: flex; gap: 4px;">
                                        <select id="minViews" class="form-select" style="flex: 1;">
                                            <option value="">ìµœì†Œ</option>
                                            <option value="1000">1K+</option>
                                            <option value="10000">10K+</option>
                                            <option value="100000">100K+</option>
                                            <option value="1000000">1M+</option>
                                            <option value="custom">ì§ì ‘</option>
                                        </select>
                                        <select id="maxViews" class="form-select" style="flex: 1;">
                                            <option value="">ìµœëŒ€</option>
                                            <option value="10000">10K</option>
                                            <option value="100000">100K</option>
                                            <option value="1000000">1M</option>
                                            <option value="10000000">10M</option>
                                            <option value="custom">ì§ì ‘</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 4px; margin-top: 4px;">
                                        <input type="number" id="minViewsCustom" class="form-input" placeholder="ìµœì†Œ" style="display: none; flex: 1;">
                                        <input type="number" id="maxViewsCustom" class="form-input" placeholder="ìµœëŒ€" style="display: none; flex: 1;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">êµ¬ë…ì ë²”ìœ„</label>
                                    <div style="display: flex; gap: 4px;">
                                        <select id="minSubscribers" class="form-select" style="flex: 1;">
                                            <option value="">ìµœì†Œ</option>
                                            <option value="1000">1K+</option>
                                            <option value="10000">10K+</option>
                                            <option value="100000">100K+</option>
                                            <option value="1000000">1M+</option>
                                            <option value="custom">ì§ì ‘</option>
                                        </select>
                                        <select id="maxSubscribers" class="form-select" style="flex: 1;">
                                            <option value="">ìµœëŒ€</option>
                                            <option value="10000">10K</option>
                                            <option value="100000">100K</option>
                                            <option value="1000000">1M</option>
                                            <option value="10000000">10M</option>
                                            <option value="custom">ì§ì ‘</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 4px; margin-top: 4px;">
                                        <input type="number" id="minSubscribersCustom" class="form-input" placeholder="ìµœì†Œ" style="display: none; flex: 1;">
                                        <input type="number" id="maxSubscribersCustom" class="form-input" placeholder="ìµœëŒ€" style="display: none; flex: 1;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ì°¸ì—¬ë„ ì§€í‘œ -->
                        <div class="filter-category">
                            <h4 class="filter-category-title">ğŸ’¬ ì°¸ì—¬ë„ í•„í„°</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">ìµœì†Œ ì°¸ì—¬ìœ¨ (%)</label>
                                    <select id="minEngagementRate" class="form-select">
                                        <option value="">ì œí•œì—†ìŒ</option>
                                        <option value="1">1%+</option>
                                        <option value="2">2%+</option>
                                        <option value="5">5%+</option>
                                        <option value="10">10%+</option>
                                        <option value="custom">ì§ì ‘ì…ë ¥</option>
                                    </select>
                                    <input type="number" id="minEngagementRateCustom" class="form-input" placeholder="0-100%" min="0" max="100" step="0.1" style="display: none; margin-top: 4px;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ì¢‹ì•„ìš”/ëŒ“ê¸€</label>
                                    <div style="display: flex; gap: 4px;">
                                        <select id="minLikes" class="form-select" style="flex: 1;">
                                            <option value="">ì¢‹ì•„ìš”</option>
                                            <option value="100">100+</option>
                                            <option value="1000">1K+</option>
                                            <option value="10000">10K+</option>
                                            <option value="custom">ì§ì ‘</option>
                                        </select>
                                        <select id="minComments" class="form-select" style="flex: 1;">
                                            <option value="">ëŒ“ê¸€</option>
                                            <option value="10">10+</option>
                                            <option value="100">100+</option>
                                            <option value="1000">1K+</option>
                                            <option value="custom">ì§ì ‘</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 4px; margin-top: 4px;">
                                        <input type="number" id="minLikesCustom" class="form-input" placeholder="ì¢‹ì•„ìš”" style="display: none; flex: 1;">
                                        <input type="number" id="minCommentsCustom" class="form-input" placeholder="ëŒ“ê¸€" style="display: none; flex: 1;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button type="button" class="btn btn-secondary" onclick="resetAdvancedFilters()">í•„í„° ì´ˆê¸°í™”</button>
                            <button type="button" class="btn btn-accent" onclick="applyAdvancedFilters()">í•„í„° ì ìš©</button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="search-btn">
                    ğŸ” ê²€ìƒ‰ ë° ë¶„ì„ ì‹œì‘
                </button>
                </form>
            </div>
            <!-- ê²€ìƒ‰ ê²°ê³¼ -->
            <div id="error-message" class="error" style="display: none;"></div>
            <div class="results-section" id="results-section" style="display: none;">
                <div class="results-header">
                    <h3>ê²€ìƒ‰ ê²°ê³¼</h3>
                    <span class="results-count" id="results-count">0ê°œ ê²°ê³¼</span>
                </div>
                
                <div id="loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>ê²€ìƒ‰ ì¤‘...</p>
                </div>
                <div class="results-grid" id="results-grid" style="display: grid; gap: 1px; background: var(--border-primary);"></div>
                <div class="pagination" id="pagination" style="display: none;">
                    <button id="prev-btn" disabled>ì´ì „</button>
                    <button id="next-btn" disabled>ë‹¤ìŒ</button>
                </div>
            </div>
            <div class="loading" id="searchLoading">
                <div class="spinner"></div>
                <p>ì˜ìƒ ë¶„ì„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
            </div>
            <div id="searchResults" class="results-grid"></div>
        </div>

        <!-- ê²½ìŸì ë¶„ì„ íƒ­ -->
        <div id="competitor-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ† ê²½ìŸì ì±„ë„ ë¶„ì„</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ê²½ìŸ ì±„ë„ ì´ë¦„ ë˜ëŠ” ID</label>
                        <input type="text" id="competitorChannel" class="form-input" placeholder="ì˜ˆ: ì±„ë„ëª… ë˜ëŠ” UC...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¶„ì„ ê¹Šì´</label>
                        <select id="competitorAnalysisType" class="form-select">
                            <option value="basic">ê¸°ë³¸ ë¶„ì„</option>
                            <option value="detailed">ìƒì„¸ ë¶„ì„</option>
                            <option value="comprehensive">ì¢…í•© ë¶„ì„</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="analyzeCompetitor()">
                    ğŸ“ˆ ê²½ìŸì ë¶„ì„ ì‹œì‘
                </button>
            </div>
            <div class="loading" id="competitorLoading">
                <div class="spinner"></div>
                <p>ê²½ìŸì ì±„ë„ ë¶„ì„ ì¤‘...</p>
            </div>
            <div id="competitorResults"></div>
        </div>

        <!-- íŠ¸ë Œë“œ ë¶„ì„ íƒ­ -->
        <div id="trending-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ”¥ íŠ¸ë Œë“œ ë¶„ì„</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                        <select id="trendingCategory" class="form-select">
                            <option value="">ì „ì²´</option>
                            <option value="1">ì˜í™” ë° ì• ë‹ˆë©”ì´ì…˜</option>
                            <option value="2">ìë™ì°¨</option>
                            <option value="10">ìŒì•…</option>
                            <option value="15">ì• ì™„ë™ë¬¼</option>
                            <option value="17">ìŠ¤í¬ì¸ </option>
                            <option value="19">ì—¬í–‰ ë° ì´ë²¤íŠ¸</option>
                            <option value="20">ê²Œì„</option>
                            <option value="22">ì‚¬ëŒ ë° ë¸”ë¡œê·¸</option>
                            <option value="23">ì½”ë¯¸ë””</option>
                            <option value="24">ì—”í„°í…Œì¸ë¨¼íŠ¸</option>
                            <option value="25">ë‰´ìŠ¤ ë° ì •ì¹˜</option>
                            <option value="26">ë…¸í•˜ìš° ë° ìŠ¤íƒ€ì¼</option>
                            <option value="27">êµìœ¡</option>
                            <option value="28">ê³¼í•™ ê¸°ìˆ </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì§€ì—­</label>
                        <select id="trendingRegion" class="form-select">
                            <option value="KR">í•œêµ­</option>
                            <option value="US">ë¯¸êµ­</option>
                            <option value="JP">ì¼ë³¸</option>
                            <option value="GB">ì˜êµ­</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="analyzeTrending()">
                    ğŸ”¥ íŠ¸ë Œë“œ ë¶„ì„ ì‹œì‘
                </button>
            </div>
            <div class="loading" id="trendingLoading">
                <div class="spinner"></div>
                <p>íŠ¸ë Œë“œ ë¶„ì„ ì¤‘...</p>
            </div>
            <div id="trendingResults"></div>
        </div>

        <!-- ì±„ë„ ë¶„ì„ íƒ­ -->
        <div id="channel-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ“º ì±„ë„ ìƒì„¸ ë¶„ì„</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ì±„ë„ ì´ë¦„ ë˜ëŠ” ID</label>
                        <input type="text" id="channelName" class="form-input" placeholder="ì˜ˆ: ì±„ë„ëª… ë˜ëŠ” UC...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¶„ì„ ê¸°ê°„</label>
                        <select id="channelPeriod" class="form-select">
                            <option value="30">ìµœê·¼ 30ì¼</option>
                            <option value="90">ìµœê·¼ 3ê°œì›”</option>
                            <option value="180">ìµœê·¼ 6ê°œì›”</option>
                            <option value="365">ìµœê·¼ 1ë…„</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="analyzeChannel()">
                    ğŸ“Š ì±„ë„ ë¶„ì„ ì‹œì‘
                </button>
            </div>
            <div class="loading" id="channelLoading">
                <div class="spinner"></div>
                <p>ì±„ë„ ë¶„ì„ ì¤‘...</p>
            </div>
            <div id="channelResults"></div>
        </div>

        <!-- í‚¤ì›Œë“œ ë§ˆì´ë‹ íƒ­ -->
        <div id="keywords-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ’¡ í‚¤ì›Œë“œ ë§ˆì´ë‹</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ê¸°ë³¸ í‚¤ì›Œë“œ</label>
                        <input type="text" id="keywordSeed" class="form-input" placeholder="ì˜ˆ: í”„ë¡œê·¸ë˜ë°">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¶„ì„ ë°©ë²•</label>
                        <select id="keywordMethod" class="form-select">
                            <option value="related">ì—°ê´€ í‚¤ì›Œë“œ</option>
                            <option value="trending">íŠ¸ë Œë”© í‚¤ì›Œë“œ</option>
                            <option value="competitor">ê²½ìŸ í‚¤ì›Œë“œ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê²°ê³¼ ìˆ˜</label>
                        <select id="keywordCount" class="form-select">
                            <option value="50">50ê°œ</option>
                            <option value="100">100ê°œ</option>
                            <option value="200">200ê°œ</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="mineKeywords()">
                    ğŸ’ í‚¤ì›Œë“œ ë§ˆì´ë‹ ì‹œì‘
                </button>
            </div>
            <div class="loading" id="keywordsLoading">
                <div class="spinner"></div>
                <p>í‚¤ì›Œë“œ ë¶„ì„ ì¤‘...</p>
            </div>
            <div id="keywordsResults"></div>
        </div>

        <!-- ì¢…í•© ë¶„ì„ íƒ­ -->
        <div id="analytics-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ“Š ì¢…í•© ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h3>
                </div>
                <div id="analyticsResults">
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        ë‹¤ë¥¸ íƒ­ì—ì„œ ë¶„ì„ì„ ìˆ˜í–‰í•˜ë©´ ì—¬ê¸°ì— ì¢…í•© ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- API Settings Modal -->
    <div id="apiModal" class="modal">
        <div class="modal-content">
            <div class="card-header">
                <h3 class="card-title">âš™ï¸ YouTube API ì„¤ì •</h3>
            </div>
            <div class="form-group">
                <label class="form-label">YouTube Data API v3 í‚¤</label>
                <input type="password" id="apiKeyInput" class="form-input" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <small style="color: var(--text-tertiary); margin-top: var(--space-xs);">
                    API í‚¤ëŠ” ë¡œì»¬ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </small>
            </div>
            <div style="display: flex; gap: var(--space-md); margin-top: var(--space-lg);">
                <button class="btn btn-primary" onclick="saveApiKey()" style="flex: 1;">ì €ì¥</button>
                <button class="btn" onclick="closeApiSettings()" style="flex: 1; background: var(--bg-tertiary);">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        class YouTubeSearchApp {
            constructor() {
                this.apiKey = '';
                this.currentResults = [];
                this.filteredResults = [];
                this.nextPageToken = '';
                this.prevPageToken = '';
                this.isApiKeyVisible = false;
                this.channelAverages = new Map();
                
                // í‚¤ì›Œë“œ íƒœê·¸ ê´€ë¦¬
                this.keywords = [];
                this.keywordInput = null;
                this.addKeywordBtn = null;
                this.keywordsDisplay = null;
                
                // API ìµœì í™” ê¸°ëŠ¥
                this.quotaUsage = parseInt(localStorage.getItem('api-quota-usage')) || 0;
                this.dailyQuotaLimit = 10000; // YouTube API v3 ì¼ì¼ í• ë‹¹ëŸ‰
                this.requestCache = new Map();
                this.cacheExpiry = 5 * 60 * 1000; // 5ë¶„ ìºì‹œ
                this.rateLimitQueue = [];
                this.lastRequestTime = 0;
                this.requestInterval = 100; // 100ms ê°„ê²©ìœ¼ë¡œ ìš”ì²­ ì œí•œ

                this.initialize();
            }

            initialize() {
                this.loadApiKey();
                this.setupEventListeners();
                this.updateQuotaDisplay();
                this.updateApiStatus();
                this.initializeModal();
                this.initializePagination();
                this.initializeAdvancedFilters();
            }

            setupEventListeners() {
                // API key input visibility toggle
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'toggleApiKeyVisibility') {
                        this.toggleApiKeyVisibility();
                    }
                });

                // Form submission
                const searchForm = document.getElementById('search-form');
                if (searchForm) {
                    searchForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.performSearch();
                    });
                    // Custom result count toggle
                    document.getElementById('maxResults').addEventListener('change', (e) => {
                        const customInput = document.getElementById('maxResultsCustom');
                        if (e.target.value === 'custom') {
                            if (customInput) customInput.style.display = 'block';
                        } else {
                            if (customInput) customInput.style.display = 'none';
                        }
                    });
                } else {
                    console.warn('Search form not found');
                }

                // ì—”í„°í‚¤ë¡œ ê²€ìƒ‰ ì‹¤í–‰
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && document.activeElement.id === 'searchQuery') {
                        e.preventDefault();
                        this.performSearch();
                    }
                });
            }

            initializePagination() {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');

                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        this.performSearch(this.prevPageToken);
                    });
                }
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        this.performSearch(this.nextPageToken);
                    });
                }
            }
            
            initializeModal() {
                const modal = document.getElementById('apiModal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeSettings();
                        }
                    });
                }

                // ESC key to close modal
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && modal && modal.classList.contains('show')) {
                        this.closeSettings();
                    }
                });
            }

            initializeAdvancedFilters() {
                // Setup event listeners for custom input fields
                const filterIds = [
                    'minViews', 'maxViews', 'minSubscribers', 'maxSubscribers',
                    'minOutlierScore', 'minEngagementRate', 'minLikes', 'minComments'
                ];

                filterIds.forEach(id => {
                    const selectElement = document.getElementById(id);
                    if (selectElement) {
                        selectElement.addEventListener('change', (e) => {
                            const customInput = document.getElementById(id + 'Custom');
                            if (customInput) {
                                if (e.target.value === 'custom') {
                                    customInput.style.display = 'inline-block';
                                } else {
                                    customInput.style.display = 'none';
                                }
                            }
                        });
                    }
                });
            }

            getMaxResults() {
                const maxResultsSelect = document.getElementById('maxResults');
                const customInput = document.getElementById('maxResultsCustom');
                
                if (maxResultsSelect && maxResultsSelect.value === 'custom' && customInput) {
                    const customValue = parseInt(customInput.value);
                    // Validate custom value (1-50 per YouTube API limits)
                    if (customValue && customValue >= 1 && customValue <= 50) {
                        return customValue.toString();
                    } else {
                        // Default to 25 if invalid custom value
                        return '25';
                    }
                }
                
                return maxResultsSelect?.value || '25';
            }

            loadApiKey() {
                this.apiKey = localStorage.getItem('youtube-api-key') || '';
                const apiKeyInput = document.getElementById('apiKeyInput');
                if (apiKeyInput) {
                    apiKeyInput.value = this.apiKey;
                }
            }

            openSettings() {
                const modal = document.getElementById('apiModal');
                if (modal) {
                    modal.classList.add('show');
                    const apiKeyInput = document.getElementById('apiKeyInput');
                    if (apiKeyInput) {
                        apiKeyInput.value = this.apiKey;
                        apiKeyInput.focus();
                    }
                }
            }

            closeSettings() {
                const modal = document.getElementById('apiModal');
                if (modal) {
                    modal.classList.remove('show');
                }
            }

            saveApiKey() {
                const apiKeyInput = document.getElementById('apiKeyInput');
                if (apiKeyInput) {
                    this.apiKey = apiKeyInput.value.trim();
                    if (this.apiKey) {
                        localStorage.setItem('youtube-api-key', this.apiKey);
                        this.updateApiStatus();
                        this.closeSettings();
                        alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        alert('ìœ íš¨í•œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    }
                }
            }

            async testApiKey() {
                if (!this.apiKey) {
                    alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    const testUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=test&maxResults=1&key=${this.apiKey}`;
                    const response = await fetch(testUrl);
                    
                    if (response.ok) {
                        alert('âœ… API í‚¤ ì—°ê²° ì„±ê³µ!');
                        this.updateApiStatus();
                    } else {
                        const error = await response.json();
                        alert(`âŒ API í‚¤ ì˜¤ë¥˜: ${error.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                    }
                } catch (error) {
                    alert('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            updateApiStatus() {
                const btn = document.getElementById('apiSettingsBtn');
                const btnText = document.getElementById('apiSettingsBtnText');
                const indicator = btn?.querySelector('.api-status-indicator');

                if (this.apiKey) {
                    if (btn) btn.classList.add('connected');
                    if (btnText) btnText.textContent = 'âœ… API ì—°ê²°ë¨';
                    if (indicator) indicator.style.background = '#51cf66';
                } else {
                    if (btn) btn.classList.remove('connected');
                    if (btnText) btnText.textContent = 'âš™ï¸ API ì„¤ì •';
                    if (indicator) indicator.style.background = 'white';
                }
            }

            updateQuotaDisplay() {
                const quotaElement = document.getElementById('quota-usage');
                if (quotaElement) {
                    const percentage = ((this.quotaUsage / this.dailyQuotaLimit) * 100).toFixed(1);
                    quotaElement.textContent = `${this.quotaUsage}/${this.dailyQuotaLimit} (${percentage}%)`;
                    
                    // Update quota warning colors
                    quotaElement.className = 'quota-usage';
                    if (percentage >= 90) {
                        quotaElement.classList.add('quota-critical');
                    } else if (percentage >= 75) {
                        quotaElement.classList.add('quota-warning');
                    }
                }
            }

            // Rate limiting function
            async rateLimitedRequest(requestFunction) {
                const now = Date.now();
                const timeSinceLastRequest = now - this.lastRequestTime;
                
                if (timeSinceLastRequest < this.requestInterval) {
                    await new Promise(resolve => setTimeout(resolve, this.requestInterval - timeSinceLastRequest));
                }
                
                this.lastRequestTime = Date.now();
                return await requestFunction();
            }

            // Cache management
            getCacheKey(params) {
                return btoa(params.toString()).replace(/[+/=]/g, '');
            }

            getCachedData(cacheKey) {
                const cached = this.requestCache.get(cacheKey);
                if (cached && (Date.now() - cached.timestamp) < this.cacheExpiry) {
                    return cached.data;
                }
                this.requestCache.delete(cacheKey);
                return null;
            }

            setCachedData(cacheKey, data) {
                this.requestCache.set(cacheKey, {
                    data: data,
                    timestamp: Date.now()
                });
                
                // Limit cache size to prevent memory issues
                if (this.requestCache.size > 100) {
                    const firstKey = this.requestCache.keys().next().value;
                    this.requestCache.delete(firstKey);
                }
            }

            async batchApiCall(ids, endpoint, type, quotaCost) {
                if (!ids.length) return { items: [] };
                
                const batchSize = 50; // API limits
                const batches = [];
                
                for (let i = 0; i < ids.length; i += batchSize) {
                    const batch = ids.slice(i, i + batchSize);
                    batches.push(batch);
                }
                
                const results = [];
                for (const batch of batches) {
                    const params = new URLSearchParams({
                        part: type === 'video-details' ? 'snippet,statistics,contentDetails' : 'snippet,statistics',
                        id: batch.join(','),
                        key: this.apiKey
                    });
                    
                    try {
                        const data = await this.callYouTubeAPI(params, endpoint, quotaCost);
                        if (data.items) {
                            results.push(...data.items);
                        }
                    } catch (error) {
                        console.warn(`Batch API call failed for ${endpoint}:`, error);
                    }
                    
                    // Small delay between batches
                    if (batches.indexOf(batch) < batches.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                }
                
                return { items: results };
            }

            async performSearch(pageToken = '') {
                if (!this.apiKey) {
                    this.showError('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // í‚¤ì›Œë“œ ì‹œìŠ¤í…œì—ì„œ ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
                const query = this.getSearchQuery();
                if (!query) {
                    this.showError('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
                    return;
                }

                this.showLoading(true);
                this.hideError();

                try {
                    // Build search parameters
                    const params = new URLSearchParams({
                        part: 'snippet',
                        type: 'video',
                        q: query,
                        maxResults: this.getMaxResults(),
                        key: this.apiKey
                    });

                    // Add optional parameters
                    const order = document.getElementById('orderBy')?.value;
                    const videoDuration = document.getElementById('videoDuration')?.value;
                    const publishedAfter = document.getElementById('publishedAfter')?.value;
                    const regionCode = document.getElementById('regionCode')?.value;

                    if (order && order !== 'outlier') params.append('order', order);
                    if (videoDuration) params.append('videoDuration', videoDuration);
                    if (regionCode) params.append('regionCode', regionCode);
                    if (pageToken) params.append('pageToken', pageToken);

                    // Add published after filter
                    if (publishedAfter) {
                        const publishedAfterDate = this.getPublishedAfterDate(publishedAfter);
                        if (publishedAfterDate) {
                            params.append('publishedAfter', publishedAfterDate);
                        }
                    }

                    // Search for videos
                    const searchData = await this.callYouTubeAPI(params, 'search', 100);
                    
                    if (!searchData.items || searchData.items.length === 0) {
                        this.showError('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }

                    // Store results and pagination tokens
                    this.currentResults = searchData.items;
                    this.filteredResults = [...searchData.items];
                    this.nextPageToken = searchData.nextPageToken || '';
                    this.prevPageToken = searchData.prevPageToken || '';

                    // Enrich results with additional data
                    await this.enrichResults();
                    
                    // Display results
                    this.displayResults();
                    this.updatePagination();

                } catch (error) {
                    console.error('Search error:', error);
                    this.showError('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            getPublishedAfterDate(period) {
                const now = new Date();
                const periods = {
                    day: new Date(now - 24 * 60 * 60 * 1000),
                    week: new Date(now - 7 * 24 * 60 * 60 * 1000),
                    month: new Date(now - 30 * 24 * 60 * 60 * 1000),
                    year: new Date(now - 365 * 24 * 60 * 60 * 1000)
                };

                return periods[period.value]?.toISOString() || '';
            }

            async callYouTubeAPI(params, endpoint = 'search', quotaCost = 1) {
                // ì¿¼í„° ì²´í¬
                if (this.quotaUsage + quotaCost > this.dailyQuotaLimit) {
                    throw new Error(`ì¼ì¼ API í• ë‹¹ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (${this.quotaUsage}/${this.dailyQuotaLimit})`);
                }

                // ìºì‹œ í™•ì¸
                const cacheKey = this.getCacheKey(params);
                const cachedData = this.getCachedData(cacheKey);
                if (cachedData) {
                    console.log('ìºì‹œëœ ë°ì´í„° ì‚¬ìš©:', cacheKey);
                    return cachedData;
                }

                // Rate limiting ì ìš©
                return await this.rateLimitedRequest(async () => {
                    const url = `https://www.googleapis.com/youtube/v3/${endpoint}?${params}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error?.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                    }
                    
                    const data = await response.json();
                    
                    // ì¿¼í„° ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸
                    this.quotaUsage += quotaCost;
                    localStorage.setItem('api-quota-usage', this.quotaUsage.toString());
                    this.updateQuotaDisplay();
                    
                    // ìºì‹œ ì €ì¥
                    this.setCachedData(cacheKey, data);
                    
                    return data;
                });
            }

            async enrichResults() {
                if (this.currentResults.length === 0) return;

                try {
                    // Get video IDs for detailed information (í•„í„°ë§ ì¶”ê°€)
                    const videoIds = this.currentResults
                        .map(item => item.id?.videoId)
                        .filter(id => id);
                    
                    if (videoIds.length === 0) return;

                    // ë°°ì¹˜ API í˜¸ì¶œë¡œ ìµœì í™”
                    const videoData = await this.batchApiCall(videoIds, 'videos', 'video-details', 3);

                    // Get channel information (ì¤‘ë³µ ì œê±°)
                    const channelIds = [...new Set(this.currentResults
                        .map(item => item.snippet?.channelId)
                        .filter(id => id))];
                    
                    const channelData = await this.batchApiCall(channelIds, 'channels', 'channel-basic', 1);

                    // Get recent videos for each channel to calculate averages
                    await this.getChannelAverages(channelIds);

                    // Merge the data
                    this.mergeEnrichedData(videoData.items || [], channelData.items || []);
                    
                    // Calculate outlier scores
                    this.calculateOutlierScores();
                    
                    // Apply advanced filters
                    this.applyAdvancedFilters();
                    
                } catch (error) {
                    console.warn('Failed to enrich results:', error);
                }
            }

            async getChannelAverages(channelIds) {
                this.channelAverages = new Map();
                
                for (const channelId of channelIds) {
                    try {
                        // Get recent videos for this channel
                        const searchParams = new URLSearchParams({
                            part: 'snippet',
                            channelId: channelId,
                            type: 'video',
                            order: 'date',
                            maxResults: '20',
                            key: this.apiKey
                        });

                        const searchResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?${searchParams}`);
                        const searchData = await searchResponse.json();
                        
                        if (searchData.items && searchData.items.length > 0) {
                            // Get video statistics for average calculation
                            const recentVideoIds = searchData.items.map(item => item.id.videoId).join(',');
                            const videoParams = new URLSearchParams({
                                part: 'statistics',
                                id: recentVideoIds,
                                key: this.apiKey
                            });

                            const videoResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?${videoParams}`);
                            const videoData = await videoResponse.json();
                            
                            // Calculate averages
                            const views = videoData.items.map(v => parseInt(v.statistics.viewCount || '0'));
                            const avgViews = views.reduce((sum, v) => sum + v, 0) / views.length;
                            
                            this.channelAverages.set(channelId, {
                                avgViews: avgViews,
                                recentVideoCount: views.length,
                                totalViews: views.reduce((sum, v) => sum + v, 0)
                            });
                        }
                    } catch (error) {
                        console.warn(`Failed to get averages for channel ${channelId}:`, error);
                        this.channelAverages.set(channelId, { avgViews: 0, recentVideoCount: 0, totalViews: 0 });
                    }
                }
            }

            mergeEnrichedData(videoDetails, channelDetails) {
                const videoMap = new Map(videoDetails.map(v => [v.id, v]));
                const channelMap = new Map(channelDetails.map(c => [c.id, c]));

                this.currentResults.forEach(item => {
                    const videoDetail = videoMap.get(item.id.videoId);
                    const channelDetail = channelMap.get(item.snippet.channelId);

                    if (videoDetail) {
                        item.statistics = videoDetail.statistics;
                        item.contentDetails = videoDetail.contentDetails;
                    }

                    if (channelDetail) {
                        item.channelStatistics = channelDetail.statistics;
                    }
                });
            }

            calculateOutlierScores() {
                this.currentResults.forEach(item => {
                    const videoViews = parseInt(item.statistics?.viewCount || '0');
                    const subscriberCount = parseInt(item.channelStatistics?.subscriberCount || '1');
                    const channelAvg = this.channelAverages.get(item.snippet.channelId);
                    const avgViews = channelAvg?.avgViews || 1;
                    
                    // Calculate engagement rate
                    const likes = parseInt(item.statistics?.likeCount || '0');
                    const comments = parseInt(item.statistics?.commentCount || '0');
                    const engagementRate = videoViews > 0 ? (likes + comments) / videoViews : 0;
                    
                    // Calculate time factor (newer videos get bonus)
                    const publishedDate = new Date(item.snippet.publishedAt);
                    const ageInDays = (new Date() - publishedDate) / (1000 * 60 * 60 * 24);
                    const timeFactor = Math.max(5 - (ageInDays / 30), 0);
                    
                    // VidIQ-style Outlier Score calculation
                    const viewRatio = Math.min((videoViews / avgViews) * 20, 60);
                    const engagementBonus = Math.min(engagementRate * 1000, 20);
                    const subscriberBonus = Math.min((videoViews / subscriberCount) * 100, 15);
                    const timeBonus = timeFactor;
                    
                    const outlierScore = Math.round(viewRatio + engagementBonus + subscriberBonus + timeBonus);
                    
                    // Add calculated data to item
                    item.outlierScore = Math.min(outlierScore, 100);
                    item.viewRatio = videoViews / avgViews;
                    item.engagementRate = engagementRate;
                    item.channelAvgViews = avgViews;
                    
                    // Calculate and set rank grade based on outlier score
                    if (item.outlierScore >= 90) item.rankGrade = 'S';
                    else if (item.outlierScore >= 70) item.rankGrade = 'A';
                    else if (item.outlierScore >= 50) item.rankGrade = 'B';
                    else if (item.outlierScore >= 30) item.rankGrade = 'C';
                    else item.rankGrade = 'D';
                });
            }

            displayResults() {
                const container = document.getElementById('searchResults') || document.getElementById('results-grid');
                if (!container) return;
                
                const resultsSection = document.getElementById('results-section');
                const resultsCount = document.getElementById('results-count');

                container.innerHTML = '';
                const totalResults = this.currentResults.length;
                const filteredCount = this.filteredResults.length;
                
                if (resultsCount) {
                    resultsCount.innerHTML = `
                        <span>${filteredCount}ê°œ ê²°ê³¼</span>
                        ${filteredCount < totalResults ? `<span style="color: var(--text-tertiary);"> (ì „ì²´ ${totalResults}ê°œ ì¤‘)</span>` : ''}
                    `;
                }
                
                if (resultsSection) {
                    resultsSection.style.display = 'block';
                }

                this.filteredResults.forEach(item => {
                    const card = this.createVideoCard(item);
                    container.appendChild(card);
                });
            }

            applyAdvancedFilters() {
                if (!this.currentResults || this.currentResults.length === 0) return;
                
                // Get filter values
                const getFilterValue = (selectId, customInputId) => {
                    const select = document.getElementById(selectId);
                    const customInput = document.getElementById(customInputId);
                    if (!select) return null;
                    
                    if (select.value === 'custom' && customInput && customInput.value) {
                        return parseFloat(customInput.value);
                    }
                    return select.value ? parseFloat(select.value) : null;
                };
                
                const filters = {
                    minViews: getFilterValue('minViews', 'minViewsCustom'),
                    maxViews: getFilterValue('maxViews', 'maxViewsCustom'),
                    minSubscribers: getFilterValue('minSubscribers', 'minSubscribersCustom'),
                    maxSubscribers: getFilterValue('maxSubscribers', 'maxSubscribersCustom'),
                    minOutlierScore: getFilterValue('minOutlierScore', 'minOutlierScoreCustom'),
                    minEngagementRate: getFilterValue('minEngagementRate', 'minEngagementRateCustom'),
                    minLikes: getFilterValue('minLikes', 'minLikesCustom'),
                    minComments: getFilterValue('minComments', 'minCommentsCustom'),
                    minRankGrade: document.getElementById('minRankGrade')?.value || null
                };
                
                // Apply filters
                this.filteredResults = this.currentResults.filter(video => {
                    // Views filter
                    const views = parseInt(video.statistics?.viewCount || 0);
                    if (filters.minViews !== null && views < filters.minViews) return false;
                    if (filters.maxViews !== null && views > filters.maxViews) return false;
                    
                    // Subscribers filter (channel data)
                    const subscribers = parseInt(video.channelStatistics?.subscriberCount || 0);
                    if (filters.minSubscribers !== null && subscribers < filters.minSubscribers) return false;
                    if (filters.maxSubscribers !== null && subscribers > filters.maxSubscribers) return false;
                    
                    // Outlier Score filter
                    if (filters.minOutlierScore !== null && (video.outlierScore || 0) < filters.minOutlierScore) return false;
                    
                    // Engagement Rate filter
                    const likes = parseInt(video.statistics?.likeCount || 0);
                    const engagementRate = views > 0 ? (likes / views) * 100 : 0;
                    if (filters.minEngagementRate !== null && engagementRate < filters.minEngagementRate) return false;
                    
                    // Likes filter
                    if (filters.minLikes !== null && likes < filters.minLikes) return false;
                    
                    // Comments filter
                    const comments = parseInt(video.statistics?.commentCount || 0);
                    if (filters.minComments !== null && comments < filters.minComments) return false;
                    
                    // Rank Grade filter
                    if (filters.minRankGrade) {
                        const rankOrder = { 'S': 5, 'A': 4, 'B': 3, 'C': 2, 'D': 1 };
                        const videoRank = video.rankGrade || 'D';
                        const minRankValue = rankOrder[filters.minRankGrade] || 1;
                        const videoRankValue = rankOrder[videoRank] || 1;
                        
                        if (videoRankValue < minRankValue) return false;
                    }
                    
                    return true;
                });
                
                // Re-display results with filters applied
                this.displayResults();
                
                console.log(`Advanced filters applied. ${this.filteredResults.length} results out of ${this.currentResults.length} total results.`);
            }

            createVideoCard(item) {
                const card = document.createElement('div');
                card.className = 'video-card';

                const thumbnail = item.snippet.thumbnails.medium || item.snippet.thumbnails.default;
                const stats = item.statistics || {};
                const viewCount = this.formatNumber(parseInt(stats.viewCount || '0'));
                const duration = this.formatDuration(item.contentDetails?.duration);
                const publishedAt = this.formatDate(item.snippet.publishedAt);
                const subscriberCount = this.formatNumber(parseInt(item.channelStatistics?.subscriberCount || '0'));
                
                // Outlier score and ranking
                const outlierScore = item.outlierScore || 0;
                const rank = this.getOutlierRank(outlierScore);
                const viewRatio = item.viewRatio || 0;
                const channelAvgViews = this.formatNumber(item.channelAvgViews || 0);
                const engagementRate = ((item.engagementRate || 0) * 100).toFixed(2);

                card.innerHTML = `
                    <div class="thumbnail">
                        <img src="${thumbnail.url}" alt="${this.cleanText(item.snippet.title)}" loading="lazy">
                        ${duration ? `<div class="duration">${duration}</div>` : ''}
                        <div class="outlier-badge ${rank.class}">${rank.emoji} ${rank.grade}</div>
                    </div>
                    <div class="video-info">
                        <a href="https://www.youtube.com/watch?v=${item.id.videoId}" 
                           target="_blank" class="video-title">
                            ${this.cleanText(item.snippet.title)}
                        </a>
                        <div class="channel-name">${this.cleanText(item.snippet.channelTitle)}</div>
                        <div class="video-meta">
                            <span>ì¡°íšŒìˆ˜ ${viewCount}</span>
                            <span>êµ¬ë…ì ${subscriberCount}</span>
                            <span>${publishedAt}</span>
                        </div>
                        <div class="benchmarking-data">
                            <span>ğŸ“Š Score: ${outlierScore}ì </span>
                            <span>ğŸ“ˆ í‰ê·  ëŒ€ë¹„: ${viewRatio.toFixed(1)}ë°°</span>
                            <span>ğŸ’¬ ì°¸ì—¬ë„: ${engagementRate}%</span>
                            <span>ğŸ“º ì±„ë„ í‰ê· : ${channelAvgViews}</span>
                        </div>
                    </div>
                    <div class="video-stats">
                        <div class="outlier-score-detail">
                            <div class="score-main">${outlierScore}</div>
                            <div class="score-label">Outlier Score</div>
                        </div>
                        <div class="view-count">${viewCount} ì¡°íšŒ</div>
                        <div class="published">${publishedAt}</div>
                    </div>
                `;

                return card;
            }

            getOutlierRank(score) {
                if (score >= 90) return { grade: 'S', emoji: 'ğŸ†', class: 'rank-s' };
                if (score >= 70) return { grade: 'A', emoji: 'â­', class: 'rank-a' };
                if (score >= 50) return { grade: 'B', emoji: 'ğŸ”¥', class: 'rank-b' };
                if (score >= 30) return { grade: 'C', emoji: 'ğŸ“ˆ', class: 'rank-c' };
                return { grade: 'D', emoji: 'ğŸ“‰', class: 'rank-d' };
            }

            formatNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                }
                return num.toLocaleString();
            }

            formatDuration(isoDuration) {
                if (!isoDuration) return '';
                
                const match = isoDuration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
                if (!match) return '';

                const hours = parseInt(match[1] || '0');
                const minutes = parseInt(match[2] || '0');
                const seconds = parseInt(match[3] || '0');

                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            formatDate(isoDate) {
                const date = new Date(isoDate);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 1) return '1ì¼ ì „';
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                if (diffDays < 30) return `${Math.floor(diffDays / 7)}ì£¼ ì „`;
                if (diffDays < 365) return `${Math.floor(diffDays / 30)}ê°œì›” ì „`;
                return `${Math.floor(diffDays / 365)}ë…„ ì „`;
            }

            cleanText(text) {
                if (!text) return '';
                
                // Comprehensive HTML entity decoding
                let decoded = text;
                
                // Common HTML entities map
                const entities = {
                    '&#39;': "'",
                    '&quot;': '"',
                    '&amp;': '&',
                    '&lt;': '<',
                    '&gt;': '>',
                    '&nbsp;': ' ',
                    '&#x27;': "'",
                    '&#x2F;': '/',
                    '&#x3D;': '=',
                    '&#x60;': '`'
                };
                
                // Replace known entities first
                for (const [entity, replacement] of Object.entries(entities)) {
                    decoded = decoded.replace(new RegExp(entity, 'g'), replacement);
                }
                
                // Use textarea for any remaining entities
                const textarea = document.createElement('textarea');
                textarea.innerHTML = decoded;
                decoded = textarea.value;
                
                return decoded;
            }

            updatePagination() {
                const pagination = document.getElementById('pagination');
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');

                if (prevBtn && nextBtn) {
                    prevBtn.disabled = !this.prevPageToken;
                    nextBtn.disabled = !this.nextPageToken;
                }
                
                if (pagination) {
                    pagination.style.display = (this.prevPageToken || this.nextPageToken) ? 'flex' : 'none';
                }
            }

            showLoading(show) {
                const loading = document.getElementById('searchLoading') || document.getElementById('loading');
                const searchBtn = document.getElementById('search-btn');
                
                if (loading) {
                    loading.style.display = show ? 'block' : 'none';
                    if (show) {
                        loading.classList.add('show');
                    } else {
                        loading.classList.remove('show');
                    }
                }
                
                if (searchBtn) {
                    searchBtn.disabled = show;
                    searchBtn.textContent = show ? 'ê²€ìƒ‰ ì¤‘...' : 'ğŸ” ê²€ìƒ‰ ë° ë¶„ì„ ì‹œì‘';
                }
            }

            showError(message) {
                const errorDiv = document.getElementById('error-message');
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                } else {
                    // Create error display in results area
                    const container = document.getElementById('searchResults') || document.getElementById('results-grid');
                    if (container) {
                        container.innerHTML = `<div class="card" style="background: var(--error); color: white;"><div class="card-header"><h3>âš ï¸ ì˜¤ë¥˜</h3></div><p>${message}</p></div>`;
                    }
                }
            }

            hideError() {
                const errorDiv = document.getElementById('error-message');
                if (errorDiv) {
                    errorDiv.style.display = 'none';
                }
            }
            
            // í‚¤ì›Œë“œ íƒœê·¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            initKeywordSystem() {
                this.keywordInput = document.getElementById('searchQuery');
                this.addKeywordBtn = document.getElementById('addKeywordBtn');
                this.keywordsDisplay = document.getElementById('keywordsDisplay');
                
                if (!this.keywordInput || !this.addKeywordBtn || !this.keywordsDisplay) {
                    console.warn('í‚¤ì›Œë“œ ì‹œìŠ¤í…œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                this.addKeywordBtn.addEventListener('click', () => {
                    this.addKeyword();
                });
                
                this.keywordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.addKeyword();
                    }
                });
                
                // ì €ì¥ëœ í‚¤ì›Œë“œ ë¡œë“œ
                this.loadSavedKeywords();
            }
            
            // í‚¤ì›Œë“œ ì¶”ê°€
            async addKeyword() {
                const input = this.keywordInput.value.trim();
                if (!input) return;
                
                let keywordData = {
                    text: '',
                    type: 'keyword', // 'keyword' ë˜ëŠ” 'url'
                    original: input
                };
                
                // URLì¸ì§€ í™•ì¸
                if (this.isYouTubeURL(input)) {
                    keywordData.type = 'url';
                    // URLì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ (ë¹„ë™ê¸°)
                    try {
                        this.showNotification('URLì—ì„œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                        keywordData.text = await this.extractKeywordsFromURL(input);
                    } catch (error) {
                        console.error('í‚¤ì›Œë“œ ì¶”ì¶œ ì˜¤ë¥˜:', error);
                        keywordData.text = `url_${Date.now()}`;
                    }
                } else {
                    keywordData.text = input;
                }
                
                // ì¤‘ë³µ ì²´í¬
                if (this.keywords.some(k => k.text === keywordData.text)) {
                    this.showNotification('ì´ë¯¸ ì¶”ê°€ëœ í‚¤ì›Œë“œì…ë‹ˆë‹¤.', 'warning');
                    return;
                }
                
                this.keywords.push(keywordData);
                this.keywordInput.value = '';
                this.updateKeywordsDisplay();
                this.saveKeywords();
                
                this.showNotification(`${keywordData.type === 'url' ? 'URLì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ' : 'í‚¤ì›Œë“œ ì¶”ê°€'}: ${keywordData.text}`, 'success');
            }
            
            // YouTube URL í™•ì¸
            isYouTubeURL(text) {
                const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com\/(watch\?v=|embed\/|v\/)|youtu\.be\/)/;
                return youtubeRegex.test(text);
            }
            
            // URLì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ
            async extractKeywordsFromURL(url) {
                try {
                    // YouTube URLì—ì„œ ë¹„ë””ì˜¤ ID ì¶”ì¶œ
                    let videoId = this.extractVideoId(url);
                    
                    if (videoId) {
                        // APIê°€ ìˆìœ¼ë©´ ë¹„ë””ì˜¤ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ
                        if (this.apiKey) {
                            try {
                                const videoInfo = await this.getVideoInfo(videoId);
                                if (videoInfo) {
                                    return this.extractKeywordsFromVideoInfo(videoInfo);
                                }
                            } catch (error) {
                                console.warn('APIë¥¼ í†µí•œ ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                            }
                        }
                        
                        // APIê°€ ì—†ê±°ë‚˜ ì‹¤íŒ¨í•œ ê²½ìš°, ë¹„ë””ì˜¤ ID ê¸°ë°˜ í‚¤ì›Œë“œ ìƒì„±
                        return `video_${videoId.substring(0, 8)}`;
                    }
                    
                    // ì±„ë„ URLì¸ì§€ í™•ì¸
                    if (url.includes('/channel/') || url.includes('/c/') || url.includes('/@')) {
                        const channelKeyword = this.extractChannelKeyword(url);
                        return channelKeyword || `channel_${Date.now()}`;
                    }
                    
                    // ì¼ë°˜ URLì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ
                    const urlParts = url.split(/[\/\?\&\=\_\-]+/);
                    const keywords = urlParts.filter(part => 
                        part.length > 2 && 
                        !part.match(/^(https?|www|com|youtube|youtu|be|watch|embed|v|channel|c)$/i)
                    ).slice(0, 3).join('_');
                    
                    return keywords || `youtube_url_${Date.now()}`;
                } catch (error) {
                    console.error('URL í‚¤ì›Œë“œ ì¶”ì¶œ ì˜¤ë¥˜:', error);
                    return `url_keyword_${Date.now()}`;
                }
            }
            
            // ë¹„ë””ì˜¤ ID ì¶”ì¶œ
            extractVideoId(url) {
                let videoId = '';
                
                if (url.includes('watch?v=')) {
                    videoId = url.split('watch?v=')[1].split('&')[0];
                } else if (url.includes('youtu.be/')) {
                    videoId = url.split('youtu.be/')[1].split('?')[0];
                } else if (url.includes('/embed/')) {
                    videoId = url.split('/embed/')[1].split('?')[0];
                } else if (url.includes('/v/')) {
                    videoId = url.split('/v/')[1].split('?')[0];
                }
                
                return videoId;
            }
            
            // ì±„ë„ í‚¤ì›Œë“œ ì¶”ì¶œ
            extractChannelKeyword(url) {
                if (url.includes('/@')) {
                    return url.split('/@')[1].split('/')[0];
                } else if (url.includes('/c/')) {
                    return url.split('/c/')[1].split('/')[0];
                } else if (url.includes('/channel/')) {
                    const channelId = url.split('/channel/')[1].split('/')[0];
                    return `ch_${channelId.substring(0, 8)}`;
                }
                return null;
            }
            
            // ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            async getVideoInfo(videoId) {
                try {
                    const response = await fetch(
                        `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=snippet,statistics&key=${this.apiKey}`
                    );
                    
                    if (!response.ok) {
                        throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                    }
                    
                    const data = await response.json();
                    return data.items && data.items.length > 0 ? data.items[0] : null;
                } catch (error) {
                    console.error('ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    return null;
                }
            }
            
            // ë¹„ë””ì˜¤ ì •ë³´ì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ
            extractKeywordsFromVideoInfo(videoInfo) {
                try {
                    const snippet = videoInfo.snippet;
                    let keywords = [];
                    
                    // ì œëª©ì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ
                    const title = snippet.title || '';
                    const titleWords = title.split(/[\s\-_]+/)
                        .filter(word => word.length > 2 && word.length < 15)
                        .slice(0, 3);
                    keywords.push(...titleWords);
                    
                    // íƒœê·¸ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
                    if (snippet.tags && snippet.tags.length > 0) {
                        keywords.push(...snippet.tags.slice(0, 2));
                    }
                    
                    // ì¹´í…Œê³ ë¦¬ IDì—ì„œ í‚¤ì›Œë“œ ìƒì„± (ì„ íƒì‚¬í•­)
                    if (snippet.categoryId) {
                        const categoryMap = {
                            '1': 'film', '2': 'autos', '10': 'music', '15': 'pets',
                            '17': 'sports', '19': 'travel', '20': 'gaming', '22': 'people',
                            '23': 'comedy', '24': 'entertainment', '25': 'news', '26': 'howto',
                            '27': 'education', '28': 'science'
                        };
                        const category = categoryMap[snippet.categoryId];
                        if (category) keywords.push(category);
                    }
                    
                    // ì¤‘ë³µ ì œê±° ë° ì •ë¦¬
                    keywords = [...new Set(keywords)]
                        .filter(keyword => keyword && keyword.length > 1)
                        .slice(0, 3);
                    
                    return keywords.length > 0 ? keywords.join('_') : `video_${videoInfo.id}`;
                } catch (error) {
                    console.error('ë¹„ë””ì˜¤ ì •ë³´ í‚¤ì›Œë“œ ì¶”ì¶œ ì˜¤ë¥˜:', error);
                    return `video_${videoInfo.id || Date.now()}`;
                }
            }
            
            // í‚¤ì›Œë“œ ì‚­ì œ
            removeKeyword(index) {
                if (index >= 0 && index < this.keywords.length) {
                    const removed = this.keywords.splice(index, 1)[0];
                    this.updateKeywordsDisplay();
                    this.saveKeywords();
                    this.showNotification(`í‚¤ì›Œë“œ ì‚­ì œ: ${removed.text}`, 'info');
                }
            }
            
            // í‚¤ì›Œë“œ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateKeywordsDisplay() {
                if (!this.keywordsDisplay) return;
                
                this.keywordsDisplay.innerHTML = '';
                
                this.keywords.forEach((keyword, index) => {
                    const tag = document.createElement('div');
                    tag.className = `keyword-tag ${keyword.type === 'url' ? 'url-tag' : ''}`;
                    
                    tag.innerHTML = `
                        <span>${keyword.text}</span>
                        <button class="remove-tag" onclick="youtubeApp.removeKeyword(${index})" title="ì‚­ì œ">Ã—</button>
                    `;
                    
                    this.keywordsDisplay.appendChild(tag);
                });
            }
            
            // í‚¤ì›Œë“œ ì €ì¥
            saveKeywords() {
                try {
                    localStorage.setItem('youtube-keywords', JSON.stringify(this.keywords));
                } catch (error) {
                    console.error('í‚¤ì›Œë“œ ì €ì¥ ì˜¤ë¥˜:', error);
                }
            }
            
            // ì €ì¥ëœ í‚¤ì›Œë“œ ë¡œë“œ
            loadSavedKeywords() {
                try {
                    const saved = localStorage.getItem('youtube-keywords');
                    if (saved) {
                        this.keywords = JSON.parse(saved);
                        this.updateKeywordsDisplay();
                    }
                } catch (error) {
                    console.error('í‚¤ì›Œë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
                    this.keywords = [];
                }
            }
            
            // ê²€ìƒ‰ì— ì‚¬ìš©í•  í‚¤ì›Œë“œ ë¬¸ìì—´ ìƒì„±
            getSearchQuery() {
                if (this.keywords.length === 0) {
                    return this.keywordInput.value.trim();
                }
                return this.keywords.map(k => k.text).join(' ');
            }
            
            // ì•Œë¦¼ í‘œì‹œ
            showNotification(message, type = 'info') {
                // ê°„ë‹¨í•œ ì•Œë¦¼ ì‹œìŠ¤í…œ (ê¸°ì¡´ ì½”ë“œì— ì•Œë¦¼ ì‹œìŠ¤í…œì´ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ì‚¬ìš©)
                console.log(`[${type.toUpperCase()}] ${message}`);
                
                // ì„ì‹œ ì•Œë¦¼ ìš”ì†Œ ìƒì„±
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 10000;
                    opacity: 0;
                    transform: translateX(100%);
                    transition: all 0.3s ease;
                `;
                
                // íƒ€ì…ë³„ ìƒ‰ìƒ ì„¤ì •
                switch (type) {
                    case 'success':
                        notification.style.background = 'linear-gradient(135deg, #51cf66, #40c057)';
                        break;
                    case 'warning':
                        notification.style.background = 'linear-gradient(135deg, #ffd43b, #fab005)';
                        notification.style.color = '#333';
                        break;
                    case 'error':
                        notification.style.background = 'linear-gradient(135deg, #ff6b6b, #e03131)';
                        break;
                    default:
                        notification.style.background = 'linear-gradient(135deg, #45b7d1, #339af0)';
                }
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                // ì• ë‹ˆë©”ì´ì…˜
                setTimeout(() => {
                    notification.style.opacity = '1';
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // 3ì´ˆ í›„ ì œê±°
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        }
        
        // Global variables for backward compatibility
        let apiKey = localStorage.getItem('youtube-api-key') || '';
        let currentTab = 'search';
        let analysisData = {
            videosAnalyzed: 0,
            opportunities: 0,
            competitors: 0,
            keywords: 0,
            searches: 0,
            trends: 0,
            channels: 0
        };
        
        // Initialize YouTube Search App
        let youtubeApp;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            youtubeApp = new YouTubeSearchApp();
            // ì „ì—­ ì ‘ê·¼ì„ ìœ„í•´ window ê°ì²´ì— í• ë‹¹
            window.youtubeApp = youtubeApp;
            
            // í‚¤ì›Œë“œ íƒœê·¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            youtubeApp.initKeywordSystem();
            
            if (youtubeApp && typeof youtubeApp.updateApiStatus === 'function') {
                youtubeApp.updateApiStatus();
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ API ì—°ê²° ìƒíƒœ ìë™ í™•ì¸
            const currentApiKey = getApiKey();
            if (currentApiKey) {
                console.log('ğŸ” API ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...');
                testApiConnection(currentApiKey).then(isValid => {
                    if (isValid) {
                        console.log('âœ… API ì—°ê²° ìƒíƒœ: ì •ìƒ');
                    } else {
                        console.warn('âš ï¸ API ì—°ê²° ìƒíƒœ: ì‹¤íŒ¨ - API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
                    }
                });
            }

            loadAnalyticsData();
            
            // Add search form event listener to existing form
            const searchForm = document.getElementById('search-form');
            if (searchForm) {
                console.log('âœ… Search form found and event listener attached');
                searchForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    console.log('ğŸ” Search form submitted');
                    if (youtubeApp) {
                        console.log('ğŸ“± YouTube app available, calling performSearch');
                        youtubeApp.performSearch();
                    } else {
                        console.error('âŒ YouTube app not available');
                    }
                });
            } else {
                console.error('âŒ Search form not found');
            }
        });

        // Wrapper functions for backward compatibility
        function searchVideos() {
            if (youtubeApp) {
                youtubeApp.performSearch();
            }
        }
        
        function quickSearch(query) {
            const searchInput = document.getElementById('searchQuery');
            if (searchInput) {
                searchInput.value = query;
                searchVideos();
            }
        }
        
        // Advanced Filters Functions
        function toggleAdvancedFilters() {
            const filtersContent = document.getElementById('advanced-filters');
            const toggleButton = document.querySelector('.advanced-filters-toggle');
            const toggleIcon = document.querySelector('.toggle-icon');
            
            if (filtersContent.style.display === 'none' || filtersContent.style.display === '') {
                filtersContent.style.display = 'block';
                toggleButton.classList.add('active');
                toggleIcon.style.transform = 'rotate(180deg)';
            } else {
                filtersContent.style.display = 'none';
                toggleButton.classList.remove('active');
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }
        
        function resetAdvancedFilters() {
            // Reset all filter dropdowns to their default values
            const filterIds = [
                'minViews', 'maxViews', 'minSubscribers', 'maxSubscribers',
                'minOutlierScore', 'minEngagementRate', 'minLikes', 
                'minComments', 'minRankGrade'
            ];
            
            filterIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = '';
                }
            });
            
            // Reset all custom input fields
            const customInputIds = [
                'minViewsCustom', 'maxViewsCustom', 'minSubscribersCustom', 
                'maxSubscribersCustom', 'minOutlierScoreCustom', 'minEngagementRateCustom',
                'minLikesCustom', 'minCommentsCustom'
            ];
            
            customInputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = '';
                    element.style.display = 'none';
                }
            });
            
            console.log('Advanced filters reset');
        }
        
        function applyAdvancedFilters() {
            if (youtubeApp && youtubeApp.filteredResults && youtubeApp.filteredResults.length > 0) {
                youtubeApp.applyAdvancedFilters();
            } else {
                alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²€ìƒ‰ì„ ì‹¤í–‰í•´ ì£¼ì„¸ìš”.');
            }
        }
        
        function openApiModal() {
            if (youtubeApp) {
                youtubeApp.openSettings();
            }
        }
        
        function closeApiModal() {
            if (youtubeApp) {
                youtubeApp.closeSettings();
            }
        }
        
        function saveApiKey() {
            if (youtubeApp) {
                youtubeApp.saveApiKey();
            }
        }
        
        function testApiKey() {
            if (youtubeApp) {
                youtubeApp.testApiKey();
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // API Settings
        function openApiSettings() {
            document.getElementById('apiModal').classList.add('show');
            document.getElementById('apiKeyInput').value = apiKey;
        }

        function closeApiSettings() {
            document.getElementById('apiModal').classList.remove('show');
        }

        function saveApiKey() {
            const newApiKey = document.getElementById('apiKeyInput').value.trim();
            if (newApiKey) {
                apiKey = newApiKey; // ê¸€ë¡œë²Œ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                localStorage.setItem('youtube-api-key', apiKey);

                // YouTube í´ë˜ìŠ¤ì˜ API í‚¤ë„ ì—…ë°ì´íŠ¸
                if (youtubeApp) {
                    youtubeApp.apiKey = apiKey;
                    youtubeApp.updateApiStatus();
                }

                // API í‚¤ ìë™ í…ŒìŠ¤íŠ¸
                testApiConnection(apiKey).then(isValid => {
                    closeApiSettings();
                    if (isValid) {
                        alert('âœ… API í‚¤ê°€ ì €ì¥ë˜ê³  ì—°ê²°ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        alert('âš ï¸ API í‚¤ê°€ ì €ì¥ë˜ì—ˆì§€ë§Œ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. API í‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    }
                });
            } else {
                alert('ìœ íš¨í•œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // API ì—°ê²° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        async function testApiConnection(apiKey) {
            try {
                const testUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=test&maxResults=1&key=${apiKey}`;
                const response = await fetch(testUrl);
                const data = await response.json();

                if (response.ok && !data.error) {
                    console.log('âœ… API ì—°ê²° ì„±ê³µ');
                    return true;
                } else {
                    console.error('âŒ API ì—°ê²° ì‹¤íŒ¨:', data.error?.message || 'Unknown error');
                    return false;
                }
            } catch (error) {
                console.error('âŒ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // API í‚¤ í™•ì¸ í—¬í¼ í•¨ìˆ˜
        function getApiKey() {
            // ë¨¼ì € ê¸€ë¡œë²Œ ë³€ìˆ˜ í™•ì¸, ì—†ìœ¼ë©´ localStorageì—ì„œ ë‹¤ì‹œ ë¡œë“œ
            if (!apiKey) {
                apiKey = localStorage.getItem('youtube-api-key') || '';
            }
            return apiKey;
        }

        function checkApiKey() {
            const currentApiKey = getApiKey();
            if (!currentApiKey) {
                alert('API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return false;
            }
            return true;
        }

        // Utility functions
        function showLoading(elementId, show = true) {
            const element = document.getElementById(elementId);
            if (show) {
                element.classList.add('show');
            } else {
                element.classList.remove('show');
            }
        }

        function formatNumber(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num?.toString() || '0';
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function formatDuration(isoDuration) {
            const match = isoDuration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            const hours = (match[1] || '').replace('H', '');
            const minutes = (match[2] || '').replace('M', '');
            const seconds = (match[3] || '').replace('S', '');
            
            if (hours) return `${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}`;
            return `${minutes || '0'}:${seconds.padStart(2, '0')}`;
        }

        // Video search function
        async function searchVideos() {
            if (!checkApiKey()) {
                return;
            }
            const currentApiKey = getApiKey();

            // í‚¤ì›Œë“œ ì‹œìŠ¤í…œì—ì„œ ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
            const query = youtubeApp ? youtubeApp.getSearchQuery() : document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
                return;
            }

            const order = document.getElementById('searchOrder').value;
            const publishedAfter = getPublishedAfter(document.getElementById('searchDuration').value);
            const maxResults = document.getElementById('searchMaxResults').value;

            showLoading('searchLoading', true);

            try {
                let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&order=${order}&maxResults=${maxResults}&key=${currentApiKey}`;
                
                if (publishedAfter) {
                    url += `&publishedAfter=${publishedAfter}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (!data.items?.length) {
                    throw new Error('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

                // Get video statistics
                const videoIds = data.items.map(item => item.id.videoId).join(',');
                const statsResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${currentApiKey}`
                );
                const statsData = await statsResponse.json();

                displaySearchResults(data.items, statsData.items);
                
                analysisData.searches += 1;
                updateAnalytics();

            } catch (error) {
                alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }

            showLoading('searchLoading', false);
        }

        function getPublishedAfter(duration) {
            if (!duration) return null;
            
            const now = new Date();
            switch (duration) {
                case 'hour': return new Date(now - 3600000).toISOString();
                case 'today': return new Date(now.setHours(0,0,0,0)).toISOString();
                case 'week': return new Date(now - 7*24*3600000).toISOString();
                case 'month': return new Date(now - 30*24*3600000).toISOString();
                case 'year': return new Date(now - 365*24*3600000).toISOString();
                default: return null;
            }
        }

        function displaySearchResults(videos, stats) {
            const container = document.getElementById('searchResults');
            
            const videoCards = videos.map((video, index) => {
                const stat = stats[index] || {};
                const statistics = stat.statistics || {};
                const contentDetails = stat.contentDetails || {};
                
                return `
                    <div class="video-card" onclick="openVideo('${video.id.videoId}')">
                        <div class="video-thumbnail">
                            <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                 alt="${escapeHtml(video.snippet.title)}">
                            ${contentDetails.duration ? `<div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">${formatDuration(contentDetails.duration)}</div>` : ''}
                        </div>
                        <div class="video-info">
                            <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                            <div class="video-stats">
                                <span>ğŸ‘€ ${formatNumber(parseInt(statistics.viewCount || 0))}</span>
                                <span>ğŸ‘ ${formatNumber(parseInt(statistics.likeCount || 0))}</span>
                                <span>ğŸ’¬ ${formatNumber(parseInt(statistics.commentCount || 0))}</span>
                            </div>
                            <div style="margin-top: 8px; color: var(--text-tertiary); font-size: 0.85rem;">
                                ${escapeHtml(video.snippet.channelTitle)} â€¢ ${new Date(video.snippet.publishedAt).toLocaleDateString('ko-KR')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = videoCards;
        }

        function openVideo(videoId) {
            window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
        }

        // Competitor analysis
        async function analyzeCompetitor() {
            if (!checkApiKey()) {
                return;
            }
            const currentApiKey = getApiKey();

            const channelName = document.getElementById('competitorChannel').value.trim();
            const analysisType = document.getElementById('competitorAnalysisType').value;
            
            if (!channelName) {
                alert('ì±„ë„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading('competitorLoading', true);

            try {
                // Search for channels
                const searchResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(channelName)}&type=channel&maxResults=3&key=${currentApiKey}`
                );
                const searchData = await searchResponse.json();

                if (searchData.error) {
                    throw new Error(searchData.error.message);
                }

                if (!searchData.items?.length) {
                    throw new Error('ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                const competitorResults = [];

                // Analyze found channels
                for (const channel of searchData.items) {
                    const channelId = channel.snippet.channelId;
                    
                    // Get detailed channel info
                    const channelResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${currentApiKey}`
                    );
                    const channelData = await channelResponse.json();
                    
                    if (!channelData.items?.length) continue;
                    
                    // Get recent videos
                    const videosResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=50&key=${currentApiKey}`
                    );
                    const videosData = await videosResponse.json();
                    
                    if (!videosData.items?.length) continue;
                    
                    // Get video statistics
                    const videoIds = videosData.items.map(item => item.id.videoId).filter(Boolean).join(',');
                    let videoStats = [];
                    
                    if (videoIds) {
                        const videoStatsResponse = await fetch(
                            `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${currentApiKey}`
                        );
                        const statsData = await videoStatsResponse.json();
                        videoStats = statsData.items || [];
                    }
                    
                    // Perform analysis
                    const analysis = performCompetitorAnalysis(
                        channelData.items[0], 
                        videosData.items, 
                        videoStats,
                        analysisType
                    );
                    
                    competitorResults.push(analysis);
                    
                    // Small delay to avoid rate limits
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                displayCompetitorResults(competitorResults, analysisType);
                
                analysisData.competitors += competitorResults.length;
                updateAnalytics();
                
            } catch (error) {
                console.error('Competitor analysis error:', error);
                alert('ê²½ìŸì ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }

            showLoading('competitorLoading', false);
        }

        function performCompetitorAnalysis(channelInfo, videos, videoStats, analysisType) {
            const stats = channelInfo.statistics;
            
            // Merge video data with statistics
            const videoData = videos.map(video => {
                const matchingStat = videoStats.find(stat => stat.id === video.id?.videoId);
                return {
                    ...video,
                    statistics: matchingStat?.statistics || {},
                    contentDetails: matchingStat?.contentDetails || {}
                };
            });
            
            // Basic metrics
            const subscriberCount = parseInt(stats.subscriberCount || 0);
            const totalViews = parseInt(stats.viewCount || 0);
            const videoCount = parseInt(stats.videoCount || 0);
            
            // Video performance metrics
            const videoViews = videoData.map(v => parseInt(v.statistics.viewCount || 0));
            const videoLikes = videoData.map(v => parseInt(v.statistics.likeCount || 0));
            const videoComments = videoData.map(v => parseInt(v.statistics.commentCount || 0));
            
            const avgViews = videoViews.length ? videoViews.reduce((a, b) => a + b, 0) / videoViews.length : 0;
            const avgLikes = videoLikes.length ? videoLikes.reduce((a, b) => a + b, 0) / videoLikes.length : 0;
            const avgComments = videoComments.length ? videoComments.reduce((a, b) => a + b, 0) / videoComments.length : 0;
            
            // Engagement metrics
            const engagementRate = avgViews > 0 ? ((avgLikes + avgComments) / avgViews * 100) : 0;
            const likesPerView = avgViews > 0 ? (avgLikes / avgViews * 100) : 0;
            const commentsPerView = avgViews > 0 ? (avgComments / avgViews * 100) : 0;
            
            // Upload consistency
            const sortedVideos = videoData
                .filter(v => v.snippet?.publishedAt)
                .sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
                
            let uploadFrequency = 0;
            if (sortedVideos.length > 1) {
                const daysDiff = (new Date(sortedVideos[0].snippet.publishedAt) - new Date(sortedVideos[sortedVideos.length - 1].snippet.publishedAt)) / (24 * 60 * 60 * 1000);
                uploadFrequency = sortedVideos.length / (daysDiff / 7); // videos per week
            }
            
            // Top performing content
            const topVideos = videoData
                .filter(v => v.statistics.viewCount)
                .sort((a, b) => parseInt(b.statistics.viewCount) - parseInt(a.statistics.viewCount))
                .slice(0, 10);
                
            // Content analysis
            const titleWords = videoData
                .map(v => v.snippet?.title || '')
                .join(' ')
                .toLowerCase()
                .replace(/[^\w\sê°€-í£]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
                
            const wordFreq = {};
            titleWords.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            const topKeywords = Object.entries(wordFreq)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 15)
                .map(([word, freq]) => ({ word, frequency: freq }));
            
            // Performance scoring
            const performanceScore = calculatePerformanceScore({
                subscriberCount,
                avgViews,
                engagementRate,
                uploadFrequency,
                videoCount
            });
            
            return {
                channelInfo,
                metrics: {
                    subscriberCount,
                    totalViews,
                    videoCount,
                    avgViews: Math.round(avgViews),
                    avgLikes: Math.round(avgLikes),
                    avgComments: Math.round(avgComments),
                    engagementRate: Math.round(engagementRate * 100) / 100,
                    likesPerView: Math.round(likesPerView * 100) / 100,
                    commentsPerView: Math.round(commentsPerView * 100) / 100,
                    uploadFrequency: Math.round(uploadFrequency * 10) / 10,
                    performanceScore
                },
                content: {
                    topVideos,
                    topKeywords,
                    recentVideos: sortedVideos.slice(0, 10)
                },
                insights: generateCompetitorInsights(channelInfo, {
                    subscriberCount,
                    avgViews,
                    engagementRate,
                    uploadFrequency,
                    topKeywords
                })
            };
        }

        function calculatePerformanceScore({ subscriberCount, avgViews, engagementRate, uploadFrequency, videoCount }) {
            let score = 0;
            
            // Subscriber score (0-25 points)
            if (subscriberCount >= 1000000) score += 25;
            else if (subscriberCount >= 100000) score += 20;
            else if (subscriberCount >= 10000) score += 15;
            else if (subscriberCount >= 1000) score += 10;
            else score += 5;
            
            // View performance score (0-30 points)
            const viewRatio = avgViews / (subscriberCount || 1);
            if (viewRatio >= 0.1) score += 30;
            else if (viewRatio >= 0.05) score += 25;
            else if (viewRatio >= 0.02) score += 20;
            else if (viewRatio >= 0.01) score += 15;
            else score += 10;
            
            // Engagement score (0-25 points)
            if (engagementRate >= 5) score += 25;
            else if (engagementRate >= 3) score += 20;
            else if (engagementRate >= 2) score += 15;
            else if (engagementRate >= 1) score += 10;
            else score += 5;
            
            // Consistency score (0-20 points)
            if (uploadFrequency >= 3) score += 20;
            else if (uploadFrequency >= 1) score += 15;
            else if (uploadFrequency >= 0.5) score += 10;
            else score += 5;
            
            return Math.round(score);
        }

        function generateCompetitorInsights(channelInfo, metrics) {
            const insights = [];
            const { subscriberCount, avgViews, engagementRate, uploadFrequency, topKeywords } = metrics;
            
            if (subscriberCount >= 1000000) {
                insights.push({ type: 'success', message: 'ëŒ€í˜• ì±„ë„ - ë¸Œëœë“œ íŒŒíŠ¸ë„ˆì‹­ ê¸°íšŒ ë§ìŒ' });
            } else if (subscriberCount >= 100000) {
                insights.push({ type: 'info', message: 'ì¤‘ê²¬ ì±„ë„ - ì•ˆì •ì ì¸ ìˆ˜ìµí™” ë‹¨ê³„' });
            } else {
                insights.push({ type: 'warning', message: 'ì„±ì¥ ë‹¨ê³„ ì±„ë„ - ë¹ ë¥¸ ì„±ì¥ ê°€ëŠ¥ì„±' });
            }
            
            if (engagementRate >= 3) {
                insights.push({ type: 'success', message: 'ë†’ì€ ì°¸ì—¬ë„ - ì¶©ì„±ë„ ë†’ì€ êµ¬ë…ìì¸µ' });
            } else if (engagementRate < 1) {
                insights.push({ type: 'warning', message: 'ë‚®ì€ ì°¸ì—¬ë„ - ì½˜í…ì¸  ê°œì„  í•„ìš”' });
            }
            
            if (uploadFrequency >= 3) {
                insights.push({ type: 'info', message: 'ë§¤ìš° í™œë°œí•œ ì—…ë¡œë“œ - ì•Œê³ ë¦¬ì¦˜ ì¹œí™”ì ' });
            } else if (uploadFrequency < 0.5) {
                insights.push({ type: 'warning', message: 'ì—…ë¡œë“œ ë¹ˆë„ ë‚®ìŒ - ì¼ê´€ì„± ê°œì„  í•„ìš”' });
            }
            
            if (topKeywords.length >= 10) {
                const mainKeyword = topKeywords[0].word;
                insights.push({ 
                    type: 'info', 
                    message: `ì£¼ë ¥ í‚¤ì›Œë“œ: "${mainKeyword}" - íŠ¹í™” ë¶„ì•¼ í™•ë¦½` 
                });
            }
            
            return insights;
        }

        function displayCompetitorResults(results, analysisType) {
            const container = document.getElementById('competitorResults');
            
            const resultHtml = results.map((result, index) => {
                const channel = result.channelInfo;
                const metrics = result.metrics;
                const insights = result.insights;
                
                return `
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“Š ${escapeHtml(channel.snippet.title)} ë¶„ì„ ê²°ê³¼</h3>
                            <div style="background: var(--bg-tertiary); padding: 8px 12px; border-radius: 6px; display: inline-block; margin-top: 8px;">
                                ì„±ê³¼ ì ìˆ˜: <strong style="color: var(--accent-primary);">${metrics.performanceScore}/100</strong>
                            </div>
                        </div>
                        
                        <div class="analytics-grid">
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--accent-primary);">${formatNumber(metrics.subscriberCount)}</div>
                                <div class="metric-label">êµ¬ë…ì</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--accent-secondary);">${formatNumber(metrics.videoCount)}</div>
                                <div class="metric-label">ì´ ì˜ìƒ</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--accent-tertiary);">${formatNumber(metrics.avgViews)}</div>
                                <div class="metric-label">í‰ê·  ì¡°íšŒìˆ˜</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--success);">${metrics.engagementRate}%</div>
                                <div class="metric-label">ì°¸ì—¬ë„</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--purple);">${metrics.uploadFrequency}</div>
                                <div class="metric-label">ì£¼ê°„ ì—…ë¡œë“œ</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--pink);">${metrics.likesPerView}%</div>
                                <div class="metric-label">ì¢‹ì•„ìš” ë¹„ìœ¨</div>
                            </div>
                        </div>
                        
                        ${insights.length > 0 ? `
                        <div class="insights">
                            <h4 style="margin-bottom: 16px;">ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h4>
                            ${insights.map(insight => `
                                <div class="insight-item ${insight.type}">
                                    ${insight.type === 'success' ? 'âœ…' : insight.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                                    ${insight.message}
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${result.content.topKeywords.length > 0 ? `
                        <div style="margin-top: 24px;">
                            <h4 style="margin-bottom: 16px;">ğŸ”‘ ì£¼ìš” í‚¤ì›Œë“œ</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${result.content.topKeywords.slice(0, 10).map(keyword => `
                                    <span style="background: var(--bg-tertiary); padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.1);">
                                        ${escapeHtml(keyword.word)} (${keyword.frequency})
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.content.topVideos.length > 0 ? `
                        <div style="margin-top: 24px;">
                            <h4 style="margin-bottom: 16px;">ğŸ† ì¸ê¸° ì½˜í…ì¸ </h4>
                            <div class="results-grid">
                                ${result.content.topVideos.slice(0, 6).map(video => `
                                    <div class="video-card" onclick="openVideo('${video.id?.videoId || video.id}')">
                                        <div class="video-thumbnail">
                                            <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                                 alt="${escapeHtml(video.snippet.title)}">
                                        </div>
                                        <div class="video-info">
                                            <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                                            <div class="video-stats">
                                                <span>ğŸ‘€ ${formatNumber(parseInt(video.statistics.viewCount || 0))}</span>
                                                <span>ğŸ‘ ${formatNumber(parseInt(video.statistics.likeCount || 0))}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = resultHtml;
        }

        // Trending analysis
        async function analyzeTrending() {
            if (!checkApiKey()) {
                return;
            }
            const currentApiKey = getApiKey();

            const categoryId = document.getElementById('trendingCategory').value;
            const regionCode = document.getElementById('trendingRegion').value;

            showLoading('trendingLoading', true);

            try {
                let url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails&chart=mostPopular&regionCode=${regionCode}&maxResults=50&key=${currentApiKey}`;
                
                if (categoryId) {
                    url += `&videoCategoryId=${categoryId}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (!data.items?.length) {
                    throw new Error('íŠ¸ë Œë”© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                displayTrendingResults(data.items);
                
                analysisData.trends += 1;
                updateAnalytics();

            } catch (error) {
                alert('íŠ¸ë Œë“œ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }

            showLoading('trendingLoading', false);
        }

        function displayTrendingResults(videos) {
            const container = document.getElementById('trendingResults');
            
            // Analyze trending patterns
            const trendAnalysis = analyzeTrendingPatterns(videos);
            
            const resultsHtml = `
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ”¥ íŠ¸ë Œë“œ ë¶„ì„ ê²°ê³¼</h3>
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-primary);">${formatNumber(trendAnalysis.totalViews)}</div>
                            <div class="metric-label">ì´ ì¡°íšŒìˆ˜</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-secondary);">${formatNumber(trendAnalysis.avgViews)}</div>
                            <div class="metric-label">í‰ê·  ì¡°íšŒìˆ˜</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-tertiary);">${trendAnalysis.avgEngagement.toFixed(2)}%</div>
                            <div class="metric-label">í‰ê·  ì°¸ì—¬ë„</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--success);">${trendAnalysis.shortFormCount}</div>
                            <div class="metric-label">ìˆí¼ ì½˜í…ì¸ </div>
                        </div>
                    </div>
                    
                    ${trendAnalysis.topKeywords.length > 0 ? `
                    <div style="margin: 24px 0;">
                        <h4 style="margin-bottom: 16px;">ğŸ”‘ íŠ¸ë Œë”© í‚¤ì›Œë“œ</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${trendAnalysis.topKeywords.slice(0, 15).map(keyword => `
                                <span style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: white;">
                                    ${escapeHtml(keyword.word)} (${keyword.frequency})
                                </span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="margin-top: 24px;">
                        <h4 style="margin-bottom: 16px;">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            ${Object.entries(trendAnalysis.categoryDistribution).map(([category, count]) => `
                                <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary);">${count}</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${getCategoryName(category)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ† íŠ¸ë Œë”© ì˜ìƒ</h3>
                    </div>
                    <div class="results-grid">
                        ${videos.slice(0, 20).map(video => `
                            <div class="video-card" onclick="openVideo('${video.id}')">
                                <div class="video-thumbnail">
                                    <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                         alt="${escapeHtml(video.snippet.title)}">
                                    <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">
                                        ${formatDuration(video.contentDetails.duration)}
                                    </div>
                                </div>
                                <div class="video-info">
                                    <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                                    <div class="video-stats">
                                        <span>ğŸ‘€ ${formatNumber(parseInt(video.statistics.viewCount || 0))}</span>
                                        <span>ğŸ‘ ${formatNumber(parseInt(video.statistics.likeCount || 0))}</span>
                                        <span>ğŸ’¬ ${formatNumber(parseInt(video.statistics.commentCount || 0))}</span>
                                    </div>
                                    <div style="margin-top: 8px; color: var(--text-tertiary); font-size: 0.85rem;">
                                        ${escapeHtml(video.snippet.channelTitle)} â€¢ ${new Date(video.snippet.publishedAt).toLocaleDateString('ko-KR')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = resultsHtml;
        }

        function analyzeTrendingPatterns(videos) {
            const totalViews = videos.reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0);
            const avgViews = totalViews / videos.length;
            
            // Calculate average engagement
            const engagements = videos.map(video => {
                const views = parseInt(video.statistics.viewCount || 0);
                const likes = parseInt(video.statistics.likeCount || 0);
                const comments = parseInt(video.statistics.commentCount || 0);
                return views > 0 ? ((likes + comments) / views * 100) : 0;
            });
            const avgEngagement = engagements.reduce((sum, eng) => sum + eng, 0) / engagements.length;
            
            // Count short-form content (under 1 minute)
            const shortFormCount = videos.filter(video => {
                const duration = video.contentDetails.duration;
                const match = duration.match(/PT(\d+M)?(\d+S)?/);
                const minutes = parseInt((match[1] || '0').replace('M', '')) || 0;
                const seconds = parseInt((match[2] || '0').replace('S', '')) || 0;
                return minutes === 0 && seconds < 60;
            }).length;
            
            // Analyze keywords from titles
            const titleWords = videos
                .map(video => video.snippet.title)
                .join(' ')
                .toLowerCase()
                .replace(/[^\w\sê°€-í£]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
                
            const wordFreq = {};
            titleWords.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            const topKeywords = Object.entries(wordFreq)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 20)
                .map(([word, freq]) => ({ word, frequency: freq }));
            
            // Category distribution
            const categoryDistribution = {};
            videos.forEach(video => {
                const category = video.snippet.categoryId;
                categoryDistribution[category] = (categoryDistribution[category] || 0) + 1;
            });
            
            return {
                totalViews,
                avgViews: Math.round(avgViews),
                avgEngagement,
                shortFormCount,
                topKeywords,
                categoryDistribution
            };
        }

        function getCategoryName(categoryId) {
            const categories = {
                '1': 'ì˜í™”/ì• ë‹ˆë©”ì´ì…˜',
                '2': 'ìë™ì°¨',
                '10': 'ìŒì•…',
                '15': 'ì• ì™„ë™ë¬¼',
                '17': 'ìŠ¤í¬ì¸ ',
                '19': 'ì—¬í–‰/ì´ë²¤íŠ¸',
                '20': 'ê²Œì„',
                '22': 'ì‚¬ëŒ/ë¸”ë¡œê·¸',
                '23': 'ì½”ë¯¸ë””',
                '24': 'ì—”í„°í…Œì¸ë¨¼íŠ¸',
                '25': 'ë‰´ìŠ¤/ì •ì¹˜',
                '26': 'ë…¸í•˜ìš°/ìŠ¤íƒ€ì¼',
                '27': 'êµìœ¡',
                '28': 'ê³¼í•™ê¸°ìˆ '
            };
            return categories[categoryId] || `ì¹´í…Œê³ ë¦¬ ${categoryId}`;
        }

        // Channel analysis
        async function analyzeChannel() {
            if (!checkApiKey()) {
                return;
            }
            const currentApiKey = getApiKey();

            const channelName = document.getElementById('channelName').value.trim();
            const period = parseInt(document.getElementById('channelPeriod').value);
            
            if (!channelName) {
                alert('ì±„ë„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading('channelLoading', true);

            try {
                // Search for channel
                const searchResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(channelName)}&type=channel&maxResults=1&key=${currentApiKey}`
                );
                const searchData = await searchResponse.json();

                if (searchData.error) {
                    throw new Error(searchData.error.message);
                }

                if (!searchData.items?.length) {
                    throw new Error('ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                const channelId = searchData.items[0].snippet.channelId;
                
                // Get detailed channel info
                const channelResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${currentApiKey}`
                );
                const channelData = await channelResponse.json();
                
                // Get videos from specified period
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - period);
                
                const videosResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=50&publishedAfter=${cutoffDate.toISOString()}&key=${currentApiKey}`
                );
                const videosData = await videosResponse.json();
                
                if (!videosData.items?.length) {
                    throw new Error('í•´ë‹¹ ê¸°ê°„ ë‚´ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // Get video statistics
                const videoIds = videosData.items.map(item => item.id.videoId).join(',');
                const videoStatsResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${currentApiKey}`
                );
                const videoStatsData = await videoStatsResponse.json();
                
                // Perform comprehensive channel analysis
                const analysis = performChannelAnalysis(
                    channelData.items[0],
                    videosData.items,
                    videoStatsData.items,
                    period
                );
                
                displayChannelResults(analysis);
                
                analysisData.channels += 1;
                updateAnalytics();

            } catch (error) {
                alert('ì±„ë„ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }

            showLoading('channelLoading', false);
        }

        function performChannelAnalysis(channelInfo, videos, videoStats, period) {
            // Merge video data with statistics
            const videoData = videos.map(video => {
                const matchingStat = videoStats.find(stat => stat.id === video.id.videoId);
                return {
                    ...video,
                    statistics: matchingStat?.statistics || {},
                    contentDetails: matchingStat?.contentDetails || {}
                };
            });
            
            // Performance metrics
            const totalViews = videoData.reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0);
            const totalLikes = videoData.reduce((sum, video) => sum + parseInt(video.statistics.likeCount || 0), 0);
            const totalComments = videoData.reduce((sum, video) => sum + parseInt(video.statistics.commentCount || 0), 0);
            
            const avgViews = videoData.length ? totalViews / videoData.length : 0;
            const avgLikes = videoData.length ? totalLikes / videoData.length : 0;
            const avgComments = videoData.length ? totalComments / videoData.length : 0;
            
            // Growth metrics
            const sortedVideos = videoData.sort((a, b) => new Date(a.snippet.publishedAt) - new Date(b.snippet.publishedAt));
            
            let viewGrowthRate = 0;
            if (sortedVideos.length >= 10) {
                const firstHalfAvg = sortedVideos.slice(0, Math.floor(sortedVideos.length / 2))
                    .reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0) / Math.floor(sortedVideos.length / 2);
                const secondHalfAvg = sortedVideos.slice(Math.floor(sortedVideos.length / 2))
                    .reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0) / Math.ceil(sortedVideos.length / 2);
                
                viewGrowthRate = firstHalfAvg > 0 ? ((secondHalfAvg - firstHalfAvg) / firstHalfAvg * 100) : 0;
            }
            
            // Content analysis
            const uploadSchedule = analyzeUploadSchedule(videoData);
            const contentTypes = analyzeContentTypes(videoData);
            const bestPerformingContent = videoData
                .sort((a, b) => parseInt(b.statistics.viewCount || 0) - parseInt(a.statistics.viewCount || 0))
                .slice(0, 10);
            
            // SEO and keyword analysis
            const titleKeywords = extractKeywords(videoData.map(v => v.snippet.title));
            const descriptionKeywords = extractKeywords(videoData.map(v => v.snippet.description || ''));
            
            return {
                channelInfo,
                period,
                metrics: {
                    totalVideos: videoData.length,
                    totalViews,
                    totalLikes,
                    totalComments,
                    avgViews: Math.round(avgViews),
                    avgLikes: Math.round(avgLikes),
                    avgComments: Math.round(avgComments),
                    viewGrowthRate: Math.round(viewGrowthRate * 100) / 100
                },
                content: {
                    uploadSchedule,
                    contentTypes,
                    bestPerformingContent,
                    titleKeywords: titleKeywords.slice(0, 15),
                    descriptionKeywords: descriptionKeywords.slice(0, 10)
                },
                insights: generateChannelInsights(channelInfo, {
                    avgViews,
                    viewGrowthRate,
                    videoCount: videoData.length,
                    period
                })
            };
        }

        function analyzeUploadSchedule(videoData) {
            const dayOfWeek = {};
            const hourOfDay = {};
            
            videoData.forEach(video => {
                const date = new Date(video.snippet.publishedAt);
                const day = date.getDay(); // 0 = Sunday
                const hour = date.getHours();
                
                dayOfWeek[day] = (dayOfWeek[day] || 0) + 1;
                hourOfDay[hour] = (hourOfDay[hour] || 0) + 1;
            });
            
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const bestDay = Object.entries(dayOfWeek).sort(([,a], [,b]) => b - a)[0];
            const bestHour = Object.entries(hourOfDay).sort(([,a], [,b]) => b - a)[0];
            
            return {
                bestDay: bestDay ? days[bestDay[0]] : 'ë°ì´í„° ì—†ìŒ',
                bestHour: bestHour ? `${bestHour[0]}ì‹œ` : 'ë°ì´í„° ì—†ìŒ',
                consistency: videoData.length > 5 ? 'ê·œì¹™ì ' : 'ë¶ˆê·œì¹™ì '
            };
        }

        function analyzeContentTypes(videoData) {
            const durations = { short: 0, medium: 0, long: 0 };
            
            videoData.forEach(video => {
                const duration = video.contentDetails?.duration;
                if (!duration) return;
                
                const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
                const hours = parseInt((match[1] || '0').replace('H', '')) || 0;
                const minutes = parseInt((match[2] || '0').replace('M', '')) || 0;
                const totalMinutes = hours * 60 + minutes;
                
                if (totalMinutes < 5) durations.short++;
                else if (totalMinutes < 20) durations.medium++;
                else durations.long++;
            });
            
            return durations;
        }

        function extractKeywords(textArray) {
            const words = textArray
                .join(' ')
                .toLowerCase()
                .replace(/[^\w\sê°€-í£]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
                
            const wordFreq = {};
            words.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            return Object.entries(wordFreq)
                .sort(([,a], [,b]) => b - a)
                .map(([word, freq]) => ({ word, frequency: freq }));
        }

        function generateChannelInsights(channelInfo, metrics) {
            const insights = [];
            const { avgViews, viewGrowthRate, videoCount, period } = metrics;
            
            // Upload frequency insight
            const uploadsPerDay = videoCount / period;
            if (uploadsPerDay >= 1) {
                insights.push({ type: 'success', message: 'ë§¤ìš° í™œë°œí•œ ì—…ë¡œë“œ ìŠ¤ì¼€ì¤„' });
            } else if (uploadsPerDay >= 0.2) {
                insights.push({ type: 'info', message: 'ê·œì¹™ì ì¸ ì—…ë¡œë“œ íŒ¨í„´' });
            } else {
                insights.push({ type: 'warning', message: 'ì—…ë¡œë“œ ë¹ˆë„ ê°œì„  í•„ìš”' });
            }
            
            // Growth insight
            if (viewGrowthRate > 20) {
                insights.push({ type: 'success', message: `ê°•í•œ ì„±ì¥ì„¸ (+${viewGrowthRate.toFixed(1)}%)` });
            } else if (viewGrowthRate > 0) {
                insights.push({ type: 'info', message: `ì•ˆì •ì  ì„±ì¥ (+${viewGrowthRate.toFixed(1)}%)` });
            } else if (viewGrowthRate < -10) {
                insights.push({ type: 'warning', message: `ì¡°íšŒìˆ˜ ê°ì†Œ ì¶”ì„¸ (${viewGrowthRate.toFixed(1)}%)` });
            }
            
            return insights;
        }

        function displayChannelResults(analysis) {
            const container = document.getElementById('channelResults');
            const channel = analysis.channelInfo;
            const metrics = analysis.metrics;
            
            const resultHtml = `
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ“º ${escapeHtml(channel.snippet.title)} ì±„ë„ ë¶„ì„</h3>
                        <p style="color: var(--text-secondary); margin-top: 8px;">
                            ìµœê·¼ ${analysis.period}ì¼ ê¸°ê°„ ë¶„ì„ ê²°ê³¼
                        </p>
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-primary);">${metrics.totalVideos}</div>
                            <div class="metric-label">ì—…ë¡œë“œ ì˜ìƒ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-secondary);">${formatNumber(metrics.totalViews)}</div>
                            <div class="metric-label">ì´ ì¡°íšŒìˆ˜</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-tertiary);">${formatNumber(metrics.avgViews)}</div>
                            <div class="metric-label">í‰ê·  ì¡°íšŒìˆ˜</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--success);">${metrics.viewGrowthRate > 0 ? '+' : ''}${metrics.viewGrowthRate}%</div>
                            <div class="metric-label">ì„±ì¥ë¥ </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--purple);">${formatNumber(metrics.avgLikes)}</div>
                            <div class="metric-label">í‰ê·  ì¢‹ì•„ìš”</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--pink);">${formatNumber(metrics.avgComments)}</div>
                            <div class="metric-label">í‰ê·  ëŒ“ê¸€</div>
                        </div>
                    </div>
                    
                    ${analysis.insights.length > 0 ? `
                    <div class="insights">
                        <h4 style="margin-bottom: 16px;">ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h4>
                        ${analysis.insights.map(insight => `
                            <div class="insight-item ${insight.type}">
                                ${insight.type === 'success' ? 'âœ…' : insight.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                                ${insight.message}
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-top: 24px;">
                        <div>
                            <h4 style="margin-bottom: 16px;">ğŸ“… ì—…ë¡œë“œ íŒ¨í„´</h4>
                            <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                                <p>ìµœì  ìš”ì¼: <strong>${analysis.content.uploadSchedule.bestDay}</strong></p>
                                <p>ìµœì  ì‹œê°„: <strong>${analysis.content.uploadSchedule.bestHour}</strong></p>
                                <p>ì¼ê´€ì„±: <strong>${analysis.content.uploadSchedule.consistency}</strong></p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 16px;">ğŸ“Š ì½˜í…ì¸  ìœ í˜•</h4>
                            <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                                <p>ìˆí¼ (5ë¶„ ë¯¸ë§Œ): <strong>${analysis.content.contentTypes.short}ê°œ</strong></p>
                                <p>ë¯¸ë””ì›€ (5-20ë¶„): <strong>${analysis.content.contentTypes.medium}ê°œ</strong></p>
                                <p>ë¡±í¼ (20ë¶„ ì´ìƒ): <strong>${analysis.content.contentTypes.long}ê°œ</strong></p>
                            </div>
                        </div>
                    </div>
                    
                    ${analysis.content.titleKeywords.length > 0 ? `
                    <div style="margin-top: 24px;">
                        <h4 style="margin-bottom: 16px;">ğŸ”‘ ì£¼ìš” í‚¤ì›Œë“œ</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${analysis.content.titleKeywords.map(keyword => `
                                <span style="background: var(--bg-tertiary); padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.1);">
                                    ${escapeHtml(keyword.word)} (${keyword.frequency})
                                </span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
                
                ${analysis.content.bestPerformingContent.length > 0 ? `
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ† ìµœê³  ì„±ê³¼ ì½˜í…ì¸ </h3>
                    </div>
                    <div class="results-grid">
                        ${analysis.content.bestPerformingContent.slice(0, 6).map(video => `
                            <div class="video-card" onclick="openVideo('${video.id.videoId}')">
                                <div class="video-thumbnail">
                                    <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                         alt="${escapeHtml(video.snippet.title)}">
                                    ${video.contentDetails?.duration ? `<div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">${formatDuration(video.contentDetails.duration)}</div>` : ''}
                                </div>
                                <div class="video-info">
                                    <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                                    <div class="video-stats">
                                        <span>ğŸ‘€ ${formatNumber(parseInt(video.statistics.viewCount || 0))}</span>
                                        <span>ğŸ‘ ${formatNumber(parseInt(video.statistics.likeCount || 0))}</span>
                                        <span>ğŸ’¬ ${formatNumber(parseInt(video.statistics.commentCount || 0))}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
            
            container.innerHTML = resultHtml;
        }

        // Keyword mining
        async function mineKeywords() {
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }

            const seedKeyword = document.getElementById('keywordSeed').value.trim();
            const method = document.getElementById('keywordMethod').value;
            const count = parseInt(document.getElementById('keywordCount').value);
            
            if (!seedKeyword) {
                alert('ê¸°ë³¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading('keywordsLoading', true);

            try {
                let keywords = [];
                
                switch (method) {
                    case 'related':
                        keywords = await generateRelatedKeywords(seedKeyword, count);
                        break;
                    case 'trending':
                        keywords = await findTrendingKeywords(seedKeyword, count);
                        break;
                    case 'competitor':
                        keywords = await analyzeCompetitorKeywords(seedKeyword, count);
                        break;
                }
                
                displayKeywordResults(keywords, method, seedKeyword);
                
                analysisData.keywords += 1;
                updateAnalytics();

            } catch (error) {
                alert('í‚¤ì›Œë“œ ë§ˆì´ë‹ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }

            showLoading('keywordsLoading', false);
        }

        async function generateRelatedKeywords(seedKeyword, count) {
            const currentApiKey = getApiKey();
            // Generate variations of the seed keyword
            const variations = [
                `${seedKeyword} íŠœí† ë¦¬ì–¼`,
                `${seedKeyword} ê°•ì˜`,
                `${seedKeyword} ë°©ë²•`,
                `${seedKeyword} ì´ˆë³´`,
                `${seedKeyword} ê³ ê¸‰`,
                `${seedKeyword} ì‹¤ë¬´`,
                `${seedKeyword} ê¸°ì´ˆ`,
                `${seedKeyword} ì™„ë²½`,
                `${seedKeyword} ê°€ì´ë“œ`,
                `${seedKeyword} ë°°ìš°ê¸°`,
                `${seedKeyword} ë§ˆìŠ¤í„°`,
                `${seedKeyword} í”„ë¡œ`,
                `${seedKeyword} íŒ`,
                `${seedKeyword} ë…¸í•˜ìš°`,
                `${seedKeyword} ë¹„ë²•`,
                `${seedKeyword} ì „ë¬¸`,
                `${seedKeyword} ì…ë¬¸`,
                `${seedKeyword} ì‹œì‘`,
                `${seedKeyword} í™œìš©`,
                `${seedKeyword} ì‘ìš©`
            ];
            
            const results = [];
            
            // Search for each variation to get performance data
            for (let i = 0; i < Math.min(variations.length, count); i++) {
                const keyword = variations[i];
                
                try {
                    const response = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(keyword)}&type=video&maxResults=10&key=${currentApiKey}`
                    );
                    const data = await response.json();
                    
                    if (data.items?.length) {
                        // Get video statistics to calculate metrics
                        const videoIds = data.items.map(item => item.id.videoId).join(',');
                        const statsResponse = await fetch(
                            `https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${videoIds}&key=${currentApiKey}`
                        );
                        const statsData = await statsResponse.json();
                        
                        const avgViews = statsData.items?.length ? 
                            statsData.items.reduce((sum, item) => sum + parseInt(item.statistics.viewCount || 0), 0) / statsData.items.length : 0;
                        
                        const competition = data.items.length >= 10 ? 'ë†’ìŒ' : data.items.length >= 5 ? 'ì¤‘ê°„' : 'ë‚®ìŒ';
                        
                        results.push({
                            keyword,
                            searchVolume: data.items.length,
                            avgViews: Math.round(avgViews),
                            competition,
                            competitionScore: data.items.length,
                            opportunity: calculateOpportunityScore(avgViews, data.items.length)
                        });
                    }
                    
                    // Small delay to avoid rate limits
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    console.error(`Error processing keyword: ${keyword}`, error);
                }
            }
            
            return results.sort((a, b) => b.opportunity - a.opportunity);
        }

        async function findTrendingKeywords(seedKeyword, count) {
            // Get trending videos and extract keywords related to seed
            const currentApiKey = getApiKey();
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&regionCode=KR&maxResults=50&key=${currentApiKey}`
            );
            const data = await response.json();
            
            if (!data.items?.length) {
                throw new Error('íŠ¸ë Œë”© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // Extract keywords from trending video titles
            const keywords = new Set();
            data.items.forEach(video => {
                const title = video.snippet.title.toLowerCase();
                if (title.includes(seedKeyword.toLowerCase())) {
                    const words = title.split(/\s+/).filter(word => 
                        word.length > 2 && 
                        !['the', 'and', 'for', 'are', 'but', 'not', 'you', 'all', 'can', 'had', 'her', 'was', 'one', 'our', 'out', 'day', 'get', 'has', 'him', 'his', 'how', 'its', 'new', 'now', 'old', 'see', 'two', 'who', 'boy', 'did', 'ê·¸ë¦¬ê³ ', 'í•˜ì§€ë§Œ', 'ê·¸ë˜ì„œ', 'ê·¸ëŸ°ë°'].includes(word.toLowerCase())
                    );
                    words.forEach(word => {
                        if (word.length > 2) {
                            keywords.add(`${seedKeyword} ${word}`);
                        }
                    });
                }
            });
            
            const results = [];
            const keywordArray = Array.from(keywords).slice(0, count);
            
            for (const keyword of keywordArray) {
                try {
                    const searchResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(keyword)}&type=video&maxResults=5&key=${currentApiKey}`
                    );
                    const searchData = await searchResponse.json();
                    
                    if (searchData.items?.length) {
                        const competition = searchData.items.length >= 5 ? 'ë†’ìŒ' : 'ë‚®ìŒ';
                        const trendScore = Math.random() * 100; // Simulated trend score
                        
                        results.push({
                            keyword,
                            searchVolume: searchData.items.length,
                            avgViews: 0, // Would need additional API calls
                            competition,
                            competitionScore: searchData.items.length,
                            trendScore: Math.round(trendScore),
                            opportunity: trendScore
                        });
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    console.error(`Error processing trending keyword: ${keyword}`, error);
                }
            }
            
            return results.sort((a, b) => b.trendScore - a.trendScore);
        }

        async function analyzeCompetitorKeywords(seedKeyword, count) {
            // Search for channels related to seed keyword
            const currentApiKey = getApiKey();
            const channelResponse = await fetch(
                `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(seedKeyword)}&type=channel&maxResults=5&key=${currentApiKey}`
            );
            const channelData = await channelResponse.json();
            
            if (!channelData.items?.length) {
                throw new Error('ê´€ë ¨ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            const allKeywords = [];
            
            // Analyze keywords from competitor channels
            for (const channel of channelData.items.slice(0, 3)) {
                const channelId = channel.snippet.channelId;
                
                // Get channel's recent videos
                const videosResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=20&key=${currentApiKey}`
                );
                const videosData = await videosResponse.json();
                
                if (videosData.items?.length) {
                    // Extract keywords from video titles
                    videosData.items.forEach(video => {
                        const title = video.snippet.title;
                        const words = title.toLowerCase()
                            .replace(/[^\w\sê°€-í£]/g, ' ')
                            .split(/\s+/)
                            .filter(word => word.length > 2);
                        
                        words.forEach(word => {
                            allKeywords.push(word);
                        });
                    });
                }
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // Count keyword frequency
            const keywordFreq = {};
            allKeywords.forEach(keyword => {
                keywordFreq[keyword] = (keywordFreq[keyword] || 0) + 1;
            });
            
            // Get top keywords and analyze them
            const topKeywords = Object.entries(keywordFreq)
                .sort(([,a], [,b]) => b - a)
                .slice(0, count)
                .map(([word, freq]) => word);
            
            const results = [];
            
            for (const keyword of topKeywords) {
                try {
                    const searchResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(keyword)}&type=video&maxResults=10&key=${currentApiKey}`
                    );
                    const searchData = await searchResponse.json();
                    
                    if (searchData.items?.length) {
                        const competition = searchData.items.length >= 8 ? 'ë†’ìŒ' : searchData.items.length >= 4 ? 'ì¤‘ê°„' : 'ë‚®ìŒ';
                        const frequency = keywordFreq[keyword];
                        
                        results.push({
                            keyword,
                            searchVolume: searchData.items.length,
                            avgViews: 0,
                            competition,
                            competitionScore: searchData.items.length,
                            frequency,
                            opportunity: frequency * (11 - searchData.items.length) // Higher frequency, lower competition = better opportunity
                        });
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    console.error(`Error processing competitor keyword: ${keyword}`, error);
                }
            }
            
            return results.sort((a, b) => b.opportunity - a.opportunity);
        }

        function calculateOpportunityScore(avgViews, competition) {
            // Higher average views and lower competition = better opportunity
            const viewScore = Math.min(avgViews / 10000, 10); // Max 10 points for views
            const competitionPenalty = competition / 2; // Penalty for high competition
            return Math.max(0, viewScore - competitionPenalty);
        }

        function displayKeywordResults(keywords, method, seedKeyword) {
            const container = document.getElementById('keywordsResults');
            
            const methodNames = {
                'related': 'ì—°ê´€ í‚¤ì›Œë“œ',
                'trending': 'íŠ¸ë Œë”© í‚¤ì›Œë“œ',
                'competitor': 'ê²½ìŸ í‚¤ì›Œë“œ'
            };
            
            const resultHtml = `
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ’¡ ${methodNames[method]} ë¶„ì„ ê²°ê³¼</h3>
                        <p style="color: var(--text-secondary); margin-top: 8px;">
                            ê¸°ë³¸ í‚¤ì›Œë“œ: "${seedKeyword}"
                        </p>
                    </div>
                    
                    ${keywords.length > 0 ? `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
                            <thead>
                                <tr style="background: var(--bg-tertiary); border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary);">í‚¤ì›Œë“œ</th>
                                    <th style="padding: 12px; text-align: center; color: var(--text-primary);">ê²€ìƒ‰ëŸ‰</th>
                                    ${method === 'related' ? '<th style="padding: 12px; text-align: center; color: var(--text-primary);">í‰ê·  ì¡°íšŒìˆ˜</th>' : ''}
                                    <th style="padding: 12px; text-align: center; color: var(--text-primary);">ê²½ìŸë„</th>
                                    ${method === 'trending' ? '<th style="padding: 12px; text-align: center; color: var(--text-primary);">íŠ¸ë Œë“œ ì ìˆ˜</th>' : ''}
                                    ${method === 'competitor' ? '<th style="padding: 12px; text-align: center; color: var(--text-primary);">ì‚¬ìš©ë¹ˆë„</th>' : ''}
                                    <th style="padding: 12px; text-align: center; color: var(--text-primary);">ê¸°íšŒì ìˆ˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${keywords.map((keyword, index) => `
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05); ${index % 2 === 0 ? 'background: rgba(255,255,255,0.02);' : ''}">
                                        <td style="padding: 12px; font-weight: 500;">${escapeHtml(keyword.keyword)}</td>
                                        <td style="padding: 12px; text-align: center;">${keyword.searchVolume}</td>
                                        ${method === 'related' ? `<td style="padding: 12px; text-align: center;">${formatNumber(keyword.avgViews)}</td>` : ''}
                                        <td style="padding: 12px; text-align: center;">
                                            <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; ${
                                                keyword.competition === 'ë†’ìŒ' ? 'background: rgba(255, 107, 107, 0.2); color: var(--error);' :
                                                keyword.competition === 'ì¤‘ê°„' ? 'background: rgba(255, 212, 59, 0.2); color: var(--warning);' :
                                                'background: rgba(81, 207, 102, 0.2); color: var(--success);'
                                            }">
                                                ${keyword.competition}
                                            </span>
                                        </td>
                                        ${method === 'trending' ? `<td style="padding: 12px; text-align: center;">${keyword.trendScore}</td>` : ''}
                                        ${method === 'competitor' ? `<td style="padding: 12px; text-align: center;">${keyword.frequency}</td>` : ''}
                                        <td style="padding: 12px; text-align: center; font-weight: bold; color: var(--accent-primary);">
                                            ${Math.round(keyword.opportunity * 10) / 10}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <h4 style="margin-bottom: 16px;">ğŸ¯ ì¶”ì²œ í‚¤ì›Œë“œ (ìƒìœ„ 10ê°œ)</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${keywords.slice(0, 10).map(keyword => `
                                <span style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: white; cursor: pointer;" 
                                      onclick="copyToClipboard('${keyword.keyword.replace(/'/g, "\\'")}')">
                                    ${escapeHtml(keyword.keyword)} 
                                    <small style="opacity: 0.8;">(${Math.round(keyword.opportunity * 10) / 10})</small>
                                </span>
                            `).join('')}
                        </div>
                        <p style="color: var(--text-tertiary); font-size: 0.85rem; margin-top: 8px;">
                            í‚¤ì›Œë“œë¥¼ í´ë¦­í•˜ë©´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë©ë‹ˆë‹¤.
                        </p>
                    </div>
                    ` : `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <p>í‚¤ì›Œë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                    </div>
                    `}
                </div>
            `;
            
            container.innerHTML = resultHtml;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show a temporary notification
                const notification = document.createElement('div');
                notification.textContent = 'í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--success);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    box-shadow: var(--shadow);
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 2000);
            }).catch(() => {
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // Analytics dashboard
        function loadAnalyticsData() {
            const saved = localStorage.getItem('youtube_analytics');
            if (saved) {
                analysisData = { ...analysisData, ...JSON.parse(saved) };
            }
        }

        function updateAnalytics() {
            localStorage.setItem('youtube_analytics', JSON.stringify(analysisData));
            
            const container = document.getElementById('analyticsResults');
            const total = Object.values(analysisData).reduce((sum, val) => sum + val, 0);
            
            if (total > 0) {
                container.innerHTML = `
                    <div class="analytics-grid">
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-primary);">${analysisData.searches}</div>
                            <div class="metric-label">ì˜ìƒ ê²€ìƒ‰</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-secondary);">${analysisData.competitors}</div>
                            <div class="metric-label">ê²½ìŸì ë¶„ì„</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-tertiary);">${analysisData.trends}</div>
                            <div class="metric-label">íŠ¸ë Œë“œ ë¶„ì„</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--success);">${analysisData.channels}</div>
                            <div class="metric-label">ì±„ë„ ë¶„ì„</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--purple);">${analysisData.keywords}</div>
                            <div class="metric-label">í‚¤ì›Œë“œ ë§ˆì´ë‹</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--pink);">${total}</div>
                            <div class="metric-label">ì´ ë¶„ì„</div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h4>ğŸ“ˆ ì‚¬ìš© í†µê³„</h4>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                            ${Object.entries(analysisData).map(([key, value]) => {
                                const names = {
                                    searches: 'ì˜ìƒ ê²€ìƒ‰',
                                    competitors: 'ê²½ìŸì ë¶„ì„',
                                    trends: 'íŠ¸ë Œë“œ ë¶„ì„',
                                    channels: 'ì±„ë„ ë¶„ì„',
                                    keywords: 'í‚¤ì›Œë“œ ë§ˆì´ë‹'
                                };
                                const percentage = total > 0 ? (value / total * 100).toFixed(1) : 0;
                                return `
                                    <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span>${names[key]}</span>
                                            <span style="font-weight: bold;">${value}</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${percentage}%"></div>
                                        </div>
                                        <div style="text-align: right; font-size: 0.8rem; color: var(--text-tertiary); margin-top: 4px;">
                                            ${percentage}%
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 24px;">
                        <button class="btn" onclick="resetAnalytics()" style="background: var(--error); color: white;">
                            ğŸ—‘ï¸ í†µê³„ ì´ˆê¸°í™”
                        </button>
                    </div>
                `;
            }
        }

        function resetAnalytics() {
            if (confirm('ëª¨ë“  ë¶„ì„ í†µê³„ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                analysisData = {
                    searches: 0,
                    competitors: 0,
                    trends: 0,
                    channels: 0,
                    keywords: 0
                };
                localStorage.removeItem('youtube_analytics');
                document.getElementById('analyticsResults').innerHTML = `
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ íƒ­ì—ì„œ ë¶„ì„ì„ ìˆ˜í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                `;
            }
        }

        // Initialize analytics on load
        updateAnalytics();
    </script>
</body>
</html>